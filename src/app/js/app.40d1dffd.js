(function(e){function t(t){for(var r,a,s=t[0],c=t[1],d=t[2],l=0,v=[];l<s.length;l++)a=s[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&v.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);u&&u(t);while(v.length)v.shift()();return i.push.apply(i,d||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={app:0},i=[];function a(e){return s.p+"js/"+({about:"about"}[e]||e)+"."+{about:"b8420fbd"}[e]+".js"}function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.e=function(e){var t=[],n=o[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise((function(t,r){n=o[e]=[t,r]}));t.push(n[2]=r);var i,c=document.createElement("script");c.charset="utf-8",c.timeout=120,s.nc&&c.setAttribute("nonce",s.nc),c.src=a(e);var d=new Error;i=function(t){c.onerror=c.onload=null,clearTimeout(l);var n=o[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;d.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",d.name="ChunkLoadError",d.type=r,d.request=i,n[1](d)}o[e]=void 0}};var l=setTimeout((function(){i({type:"timeout",target:c})}),12e4);c.onerror=c.onload=i,document.head.appendChild(c)}return Promise.all(t)},s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/",s.oe=function(e){throw console.error(e),e};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=d;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0418":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("header",{staticClass:"header"},[r("ul",{staticClass:"header-widgets"},[r("li",{staticClass:"header-widgets__widget header-widgets__widget--settings"},[r("router-link",{attrs:{to:"/"}},[r("svg",[r("use",{attrs:{"xlink:href":n("66b6")+"#cog"}})])])],1),r("li",{staticClass:"header-widgets__widget"},[r("label",{attrs:{for:"linear-velocity"}},[r("svg",[r("use",{attrs:{"xlink:href":n("66b6")+"#arrow-up"}})]),r("span",[e._v("Linear")])]),r("input",{staticClass:"range-widget",attrs:{onkeydown:"return false;",id:"linear-velocity",type:"range",min:"1",max:"100",value:"25"},on:{input:e.updateLinearVelocity}}),r("span",[e._v(e._s(this.$store.getters.linearSpeed)+"%")])]),r("li",{staticClass:"header-widgets__widget"},[r("label",{attrs:{for:"angular-velocity"}},[r("svg",[r("use",{attrs:{"xlink:href":n("66b6")+"#redo-alt"}})]),r("span",[e._v("Angular")])]),r("input",{staticClass:"range-widget",attrs:{onkeydown:"return false;",id:"angular-velocity",type:"range",min:"1",max:"100",value:"25"},on:{input:e.updateAngularVelocity}}),r("span",[e._v(e._s(this.$store.getters.angularSpeed)+"%")])]),r("li",{staticClass:"header-widgets__widget"},[r("div",{staticClass:"battery"},[r("div",{staticClass:"battery__inner",class:{battery__charging:this.$store.getters.batterySOC},style:{width:this.$store.getters.slowRateData.reg_robot_rel_soc_a+"%"}})]),r("span",{staticClass:"battery-percentage"},[e._v(" "+e._s(this.$store.getters.slowRateData.reg_robot_rel_soc_a)+"%")])])])])},o=[],i={name:"Header",methods:{updateLinearVelocity:function(e){this.$store.dispatch("updateLinearSpeed",e.target.value)},updateAngularVelocity:function(e){this.$store.dispatch("updateAngularSpeed",e.target.value)}}},a=i,s=n("2877"),c=Object(s["a"])(a,r,o,!1,null,null,null);t["a"]=c.exports},5407:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("header",[r("div",{staticClass:"admin-header"},[r("router-link",{attrs:{to:"/"}},[r("img",{staticClass:"admin-header__logo",attrs:{src:n("c911")}})]),r("h1",{staticClass:"admin-header__title"},[e._v(e._s(this.title))])],1)])},o=[],i=n("0418"),a={name:"AdminHeader",components:{Header:i["a"]},props:["title"]},s=a,c=n("2877"),d=Object(c["a"])(s,r,o,!1,null,"44ad3913",null);t["a"]=d.exports},5636:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("AdminHeader",{attrs:{title:"Developer Settings"}}),n("section",{staticClass:"control-panel"},[n("div",{staticClass:"control-item"},[n("label",{staticClass:"control-item__label"},[e._v("ROS URL")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.rosURL,expression:"rosURL"}],staticClass:"control-item__input",attrs:{id:"ros-url",type:"text",name:"ros-url",placeholder:"ROS url"},domProps:{value:e.rosURL},on:{input:function(t){t.target.composing||(e.rosURL=t.target.value)}}}),n("button",{staticClass:"btn btn--setting",on:{click:function(t){return e.setROSURL(e.rosURL)}}},[e._v("Update")])]),n("div",{staticClass:"control-item"},[n("label",{staticClass:"control-item__label"},[e._v("JANUS URL")]),n("input",{directives:[{name:"model",rawName:"v-model",value:e.janusURL,expression:"janusURL"}],staticClass:"control-item__input",attrs:{id:"janus-url",type:"text",name:"ros-url",placeholder:"Janus url"},domProps:{value:e.janusURL},on:{input:function(t){t.target.composing||(e.janusURL=t.target.value)}}}),n("button",{staticClass:"btn btn--setting",on:{click:function(t){return e.setJanusUrl(e.janusURL)}}},[e._v("Update")])])])],1)},o=[],i=(n("8e6e"),n("ac6a"),n("456d"),n("bd86")),a=n("2f62"),s=n("5407");function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(n,!0).forEach((function(t){Object(i["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={name:"DeveloperSettings",components:{AdminHeader:s["a"]},data:function(){return{rosURL:JSON.parse(window.localStorage.getItem("rosURL"))||"ws://".concat(window.location.hostname,":9090"),janusURL:this.$store.getters.janusURL}},methods:d({},Object(a["b"])(["setROSURL","getROSURL","showNotification","setJanusUrl"]))},u=l,v=n("2877"),f=Object(v["a"])(u,r,o,!1,null,null,null);t["default"]=f.exports},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("f751"),n("097d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("router-view"),n("Snackbar")],1)},i=[],a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",e._l(e.notificationMessages,(function(t,r){return n("div",{staticClass:"snackbar",class:{"snackbar--warning":"warning"===t.type,"snackbar--danger":"danger"===t.type},style:{top:90-10*r+"%"}},[e._v("\n       "+e._s(t.message)+"\n\n    ")])})),0)},s=[],c=n("2f62"),d={name:"Snackbar",computed:Object(c["c"])(["notificationShow","notificationMessages"])},l=d,u=n("2877"),v=Object(u["a"])(l,a,s,!1,null,null,null),f=v.exports,p={components:{Snackbar:f}},h=p,g=(n("5c0b"),Object(u["a"])(h,o,i,!1,null,null,null)),m=g.exports,b=n("8c4f"),w=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"rover-control"},[n("Header"),n("Dashboard")],1)},y=[],S=n("0418"),k=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("section",{attrs:{id:"joystick-area"}},[n("video",{ref:"tele-video",staticClass:"stream",attrs:{id:"stream",width:"100%",height:"100%",autoplay:"",playsinline:"true","webkit-playsinline":"true",muted:"muted"},domProps:{muted:!0}})])},_=[],T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")},C=[],R={name:"MobileControls",methods:{touchDown:function(e){this.$store.dispatch("mobileControl",e.target.dataset.val)},touchUp:function(){this.$store.dispatch("mobileControl","stop")}}},D=R,A=Object(u["a"])(D,T,C,!1,null,"1eaace98",null),O=A.exports,j={name:"Dashboard",components:{MobileControls:O},mounted:function(){this.$store.dispatch("teleopConnect",this.$refs["tele-video"])},created:function(){this.$store.dispatch("initROS")},destroyed:function(){window.location.reload()}},I=j,x=Object(u["a"])(I,k,_,!1,null,"ab5f2a40",null),E=x.exports,M={name:"RoverControl",components:{Header:S["a"],Dashboard:E}},P=M,L=Object(u["a"])(P,w,y,!1,null,null,null),V=L.exports;n("5636");r["a"].use(b["a"]);var U=new b["a"]({mode:"history",base:"/",routes:[{path:"/app/rover-link",name:"home",component:V},{path:"/",name:"control-panel",component:function(){return n.e("about").then(n.bind(null,"992e"))}},{path:"/settings/wifi",name:"wifi",component:function(){return n.e("about").then(n.bind(null,"2820"))}},{path:"/settings/developer",name:"developer",component:function(){return n.e("about").then(n.bind(null,"5636"))}}]}),N=(n("96cf"),n("3b8d")),J=n("e86b"),F=n("d225"),$=n("b0b4"),B=n("8d31"),q=function(){function e(t,n,r){Object(F["a"])(this,e),this.ROS=t,this.topic=new J["Topic"]({ros:t,name:"/cmd_vel/keyboard",messageType:"geometry_msgs/Twist"}),this.directions={forward:87,backward:83,left:65,right:68},this.throttle=6,this.currentMobileButton=null,this.joystick=new B["a"]({container:document.getElementById("joystick-area")}),this.linearScale=n/100,this.angularScale=r/100,this.x=0,this.y=0,this.z=0,window.innerWidth<1024&&this.mobileControl(),this.controlListen()}return Object($["a"])(e,[{key:"handleTouch",value:function(e,t,n,r){var o=0,i=0;o=this.throttle*this.linearScale,i=this.throttle*this.angularScale,n&&(this.z=1*i),r&&(this.z=-1*i),t&&(this.x=-.25*o),e&&(this.x=.25*o);var a=new J["Message"]({angular:{x:0,y:0,z:this.z},linear:{x:this.x,y:0,z:0}});this.topic.publish(a)}},{key:"handleKey",value:function(e,t){this.x,this.y,this.z;var n=!0,r=0,o=0;switch(!0===t&&(r=this.throttle*this.linearScale,o=this.throttle*this.angularScale),e){case 65:case 37:this.z=1*o;break;case 87:case 38:this.x=.25*r;break;case 68:case 39:this.z=-1*o;break;case 83:case 40:this.x=-.25*r;break;case 69:this.y=-.5*o;break;case 81:this.y=.5*o;break;default:n=!1}if(!0===n){var i=new J["Message"]({angular:{x:0,y:0,z:this.z},linear:{x:this.x,y:0,z:0}});this.topic.publish(i)}}},{key:"controlListen",value:function(){var e=this,t=document.getElementsByTagName("body")[0];t.addEventListener("keydown",(function(t){e.handleKey(t.keyCode,!0)}),!1),t.addEventListener("keyup",(function(t){e.handleKey(t.keyCode,!1)}),!1)}},{key:"stopRobot",value:function(){this.handleKey(this.currentMobileButton,!1),this.currentMobileButton=null,this.x=0,this.z=0}},{key:"mobileControl",value:function(){var e=this,t=document.getElementsByTagName("BODY")[0];console.log(t),t.style.cssText="overscroll-behavior: none;",document.addEventListener("touchend",(function(t){e.stopRobot()})),setInterval((function(){var t=e.joystick.right(),n=e.joystick.left(),r=e.joystick.up(),o=e.joystick.down();e.handleTouch(r,o,n,t)}),100)}},{key:"setLinearScale",set:function(e){this.linearScale=e/100}},{key:"setAngularScale",set:function(e){this.angularScale=e/100}}]),e}(),W=q,Y={rosURL:JSON.parse(window.localStorage.getItem("rosURL"))||"ws://".concat(window.location.hostname,":9090"),batterySOC:null,batteryPercent:null,ROS:null,control:null,lastReceivedTime:null,linearSpeed:25,angularSpeed:25,slowRateData:{reg_robot_rel_soc_a:0}},z={rosURL:function(e){return e.rosURL},batterySOC:function(e){return e.batterySOC},linearSpeed:function(e){return e.linearSpeed},angularSpeed:function(e){return e.angularSpeed},slowRateData:function(e){return e.slowRateData}},X={setROSURL:function(){var e=Object(N["a"])(regeneratorRuntime.mark((function e(t,n){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.commit,t.dispatch,e.next=3,window.localStorage.setItem("rosURL",JSON.stringify(n));case 3:r("rosURL",n),window.location.reload();case 5:case"end":return e.stop()}}),e)})));function t(t,n){return e.apply(this,arguments)}return t}(),getROSURL:function(){var e=Object(N["a"])(regeneratorRuntime.mark((function e(t){var n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.commit,e.next=3,JSON.parse(window.localStorage.getItem("rosURL"));case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0="ws://".concat(window.location.hostname,":9090");case 6:r=e.t0,console.log(r),n("rosURL",r);case 9:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}(),initROS:function(e){var t,n=e.commit,r=e.state,o=e.dispatch;console.log(r.rosURL),o("getROSURL");var i=new Promise((function(e,n){t=new J["Ros"]({url:r.rosURL}),setTimeout((function(){e()}),3e3)}));i.then((function(){if(t.isConnected)n("ros",t),o("subscribe"),o("publish"),o("showNotification",{message:"ROS Connected",type:""}),o("receivedROSData");else{if("/app/rover-link"!=window.location.pathname)return;o("showNotification",{message:"ROS Connection Error",type:"danger"}),o("initROS")}}))},receivedROSData:function(e){var t=e.dispatch,n=(e.commit,e.state),r=setInterval((function(){var e=Date.now();null!==n.lastReceivedTime&&e-n.lastReceivedTime>5e3&&(t("initROS"),clearInterval(r))}),5e3)},subscribe:function(e){var t=e.commit,n=(e.dispatch,e.state),r=new J["Topic"]({ros:n.ROS,name:"/rr_openrover_basic/charging",messageType:"std_msgs/Bool"}),o=new J["Topic"]({ros:n.ROS,name:"/rr_openrover_basic/raw_slow_rate_data",messageType:"rr_openrover_basic/RawRrOpenroverBasicSlowRateData"});o.subscribe((function(e){t("slowRateData",e),t("setLastReceivedTime",Date.now())})),r.subscribe((function(e){t("SOC",e.data),t("setLastReceivedTime",Date.now())}))},publish:function(e){var t=e.commit,n=e.dispatch,r=e.state,o=new W(r.ROS,r.linearSpeed,r.angularSpeed,n);t("control",o)},updateLinearSpeed:function(e,t){var n=e.commit,r=e.state;n("linearSpeed",parseInt(t)),r.control.setLinearScale=r.linearSpeed},updateAngularSpeed:function(e,t){var n=e.commit;n("angularSpeed",parseInt(t)),Y.control.setAngularScale=Y.angularSpeed},mobileControl:function(e,t){e.commit;var n=e.state;parseInt(t)?n.control.currentMobileButton=parseInt(t):"stop"===t&&n.control.stopRobot()}},H={rosURL:function(e,t){return e.rosURL=t},SOC:function(e,t){return e.batterySOC=t},ros:function(e,t){return e.ROS=t},control:function(e,t){return e.control=t},linearSpeed:function(e,t){return e.linearSpeed=t},angularSpeed:function(e,t){return e.angularSpeed=t},slowRateData:function(e,t){return e.slowRateData=t},setLastReceivedTime:function(e,t){return e.lastReceivedTime=t}},G={state:Y,getters:z,actions:X,mutations:H},K={show:!1,messages:[]},Q={notificationShow:function(e){return e.show},notificationMessages:function(e){return e.messages}},Z={showNotification:function(e,t){var n=e.commit;e.state;n("show",!0),n("messages",t),setTimeout((function(){n("show",!1),n("messages")}),2e3)}},ee={show:function(e,t){return e.show=t},messages:function(e,t){t?e.messages.push(t):void 0===t&&e.messages.pop()}},te={state:K,getters:Q,actions:Z,mutations:ee},ne=(n("aef6"),n("28a5"),n("7f7f"),n("7514"),n("7618")),re=(n("ac6a"),n("5df3"),n("4917"),n("d093"));ie.sessions={},ie.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||ie.extension.isInstalled()}return!0};var oe={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var n=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var r=new Error("NavigatorUserMediaError");r.name="You cancelled the request for permission, giving up...",n(r)}else n(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function ie(e){if(void 0===ie.initDone)return e.error("Library not initialized"),{};if(!ie.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(ie.log("Library initialized: "+ie.initDone),e=e||{},e.success="function"==typeof e.success?e.success:ie.noop,e.error="function"==typeof e.error?e.error:ie.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:ie.noop,null===e.server||void 0===e.server)return e.error("Invalid server url"),{};var t=!1,n=null,r={},o=null,i=null,a=0,s=e.server;ie.isArray(s)?(ie.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,ie.debug(i)):0===s.indexOf("ws")?(t=!0,ie.log("Using WebSockets to contact Janus: "+s)):(t=!1,ie.log("Using REST API to contact Janus: "+s));var c=e.iceServers;void 0!==c&&null!==c||(c=[{urls:"stun:stun.l.google.com:19302"}]);var d=e.iceTransportPolicy,l=e.bundlePolicy,u=e.ipv6;void 0!==u&&null!==u||(u=!1);var v=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(v=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var p=null;void 0!==e.token&&null!==e.token&&(p=e.token);var h=null;void 0!==e.apisecret&&null!==e.apisecret&&(h=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var m=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(m=e.longPollTimeout),isNaN(m)&&(m=6e4);var w=!1,y=null,S={},k=this,_=0,T={};function C(){if(null!=y)if(ie.debug("Long poll..."),w){var t=s+"/"+y+"?rid="+(new Date).getTime();void 0!==f&&null!==f&&(t=t+"&maxev="+f),null!==p&&void 0!==p&&(t=t+"&token="+encodeURIComponent(p)),null!==h&&void 0!==h&&(t=t+"&apisecret="+encodeURIComponent(h)),ie.httpAPICall(t,{verb:"GET",withCredentials:v,success:R,timeout:m,error:function(t,n){if(ie.error(t+":",n),_++,_>3)return w=!1,void e.error("Lost connection to the server (is it down?)");C()}})}else ie.warn("Is the server down? (connected=false)")}function R(e,r){if(_=0,t||void 0===y||null===y||!0===r||C(),t||!ie.isArray(e))if("keepalive"!==e["janus"])if("ack"!==e["janus"])if("success"!==e["janus"])if("trickle"===e["janus"]){var o=e["sender"];if(void 0===o||null===o)return void ie.warn("Missing sender...");var i=S[o];if(void 0===i||null===i)return void ie.debug("This handle is not attached to this session");var a=e["candidate"];ie.debug("Got a trickled candidate on session "+y),ie.debug(a);var s=i.webrtcStuff;s.pc&&s.remoteSdp?(ie.debug("Adding remote candidate:",a),a&&!0!==a.completed?s.pc.addIceCandidate(a):s.pc.addIceCandidate(ie.endOfCandidates)):(ie.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),s.candidates||(s.candidates=[]),s.candidates.push(a),ie.debug(s.candidates))}else{if("webrtcup"===e["janus"]){ie.debug("Got a webrtcup event on session "+y),ie.debug(e);o=e["sender"];if(void 0===o||null===o)return void ie.warn("Missing sender...");i=S[o];return void 0===i||null===i?void ie.debug("This handle is not attached to this session"):void i.webrtcState(!0)}if("hangup"===e["janus"]){ie.debug("Got a hangup event on session "+y),ie.debug(e);o=e["sender"];if(void 0===o||null===o)return void ie.warn("Missing sender...");i=S[o];if(void 0===i||null===i)return void ie.debug("This handle is not attached to this session");i.webrtcState(!1,e["reason"]),i.hangup()}else if("detached"===e["janus"]){ie.debug("Got a detached event on session "+y),ie.debug(e);o=e["sender"];if(void 0===o||null===o)return void ie.warn("Missing sender...");i=S[o];if(void 0===i||null===i)return;i.detached=!0,i.ondetached(),i.detach()}else if("media"===e["janus"]){ie.debug("Got a media event on session "+y),ie.debug(e);o=e["sender"];if(void 0===o||null===o)return void ie.warn("Missing sender...");i=S[o];if(void 0===i||null===i)return void ie.debug("This handle is not attached to this session");i.mediaState(e["type"],e["receiving"])}else if("slowlink"===e["janus"]){ie.debug("Got a slowlink event on session "+y),ie.debug(e);o=e["sender"];if(void 0===o||null===o)return void ie.warn("Missing sender...");i=S[o];if(void 0===i||null===i)return void ie.debug("This handle is not attached to this session");i.slowLink(e["uplink"],e["lost"])}else{if("error"===e["janus"]){ie.error("Ooops: "+e["error"].code+" "+e["error"].reason),ie.debug(e);v=e["transaction"];if(null!==v&&void 0!==v){f=T[v];null!==f&&void 0!==f&&f(e),delete T[v]}return}if("event"===e["janus"]){ie.debug("Got a plugin event on session "+y),ie.debug(e);o=e["sender"];if(void 0===o||null===o)return void ie.warn("Missing sender...");var c=e["plugindata"];if(void 0===c||null===c)return void ie.warn("Missing plugindata...");ie.debug("  -- Event is coming from "+o+" ("+c["plugin"]+")");var d=c["data"];ie.debug(d);i=S[o];if(void 0===i||null===i)return void ie.warn("This handle is not attached to this session");var l=e["jsep"];void 0!==l&&null!==l&&(ie.debug("Handling SDP as well..."),ie.debug(l));var u=i.onmessage;null!==u&&void 0!==u?(ie.debug("Notifying application..."),u(d,l)):ie.debug("No provided notification callback")}else{if("timeout"===e["janus"])return ie.error("Timeout on session "+y),ie.debug(e),void(t&&n.close(3504,"Gateway timeout"));ie.warn("Unknown message/event  '"+e["janus"]+"' on session "+y),ie.debug(e)}}}else{ie.debug("Got a success on session "+y),ie.debug(e);var v=e["transaction"];if(null!==v&&void 0!==v){var f=T[v];null!==f&&void 0!==f&&f(e),delete T[v]}}else{ie.debug("Got an ack on session "+y),ie.debug(e);var v=e["transaction"];if(null!==v&&void 0!==v){var f=T[v];null!==f&&void 0!==f&&f(e),delete T[v]}}else ie.vdebug("Got a keepalive on session "+y);else for(var p=0;p<e.length;p++)R(e[p],!0)}function D(){if(null!==s&&t&&w){o=setTimeout(D,g);var e={janus:"keepalive",session_id:y,transaction:ie.randomString(12)};null!==p&&void 0!==p&&(e["token"]=p),null!==h&&void 0!==h&&(e["apisecret"]=h),n.send(JSON.stringify(e))}}function A(c){var d=ie.randomString(12),l={janus:"create",transaction:d};if(c["reconnect"]&&(w=!1,l["janus"]="claim",l["session_id"]=y,n&&(n.onopen=null,n.onerror=null,n.onclose=null,o&&(clearTimeout(o),o=null))),null!==p&&void 0!==p&&(l["token"]=p),null!==h&&void 0!==h&&(l["apisecret"]=h),null===s&&ie.isArray(i)&&(s=i[a],0===s.indexOf("ws")?(t=!0,ie.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,ie.log("Server #"+(a+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var u in n=ie.newWebSocket(s,"janus-protocol"),r={error:function(){if(ie.error("Error connecting to the Janus WebSockets server... "+s),ie.isArray(i)&&!c["reconnect"])return a++,a==i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){A(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){T[d]=function(e){if(ie.debug(e),"success"!==e["janus"])return ie.error("Ooops: "+e["error"].code+" "+e["error"].reason),void c.error(e["error"].reason);o=setTimeout(D,g),w=!0,y=e["session_id"]?e["session_id"]:e.data["id"],c["reconnect"]?ie.log("Claimed session: "+y):ie.log("Created session: "+y),ie.sessions[y]=k,c.success()},n.send(JSON.stringify(l))},message:function(e){R(JSON.parse(e.data))},close:function(){null!==s&&w&&(w=!1,e.error("Lost connection to the server (is it down?)"))}},r)n.addEventListener(u,r[u]);else ie.httpAPICall(s,{verb:"POST",withCredentials:v,body:l,success:function(e){if(ie.debug(e),"success"!==e["janus"])return ie.error("Ooops: "+e["error"].code+" "+e["error"].reason),void c.error(e["error"].reason);w=!0,y=e["session_id"]?e["session_id"]:e.data["id"],c["reconnect"]?ie.log("Claimed session: "+y):ie.log("Created session: "+y),ie.sessions[y]=k,C(),c.success()},error:function(e,t){if(ie.error(e+":",t),ie.isArray(i)&&!c["reconnect"])return a++,a==i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){A(c)}),200));""===t?c.error(e+": Is the server down?"):c.error(e+": "+t)}})}function O(i){i=i||{},i.success="function"==typeof i.success?i.success:ie.noop;var a=!0;void 0!==i.asyncRequest&&null!==i.asyncRequest&&(a=!0===i.asyncRequest);var c=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(c=!0===i.notifyDestroyed);var d=!1;if(void 0!==i.cleanupHandles&&null!==i.cleanupHandles&&(d=!0===i.cleanupHandles),ie.log("Destroying session "+y+" (async="+a+")"),!w)return ie.warn("Is the server down? (connected=false)"),void i.success();if(void 0===y||null===y)return ie.warn("No session to destroy"),i.success(),void(c&&e.destroyed());if(d)for(var l in S)L(l,{noRequest:!0});var u={janus:"destroy",transaction:ie.randomString(12)};if(null!==p&&void 0!==p&&(u["token"]=p),null!==h&&void 0!==h&&(u["apisecret"]=h),t){u["session_id"]=y;var f=function(){for(var e in r)n.removeEventListener(e,r[e]);n.removeEventListener("message",g),n.removeEventListener("error",m),o&&clearTimeout(o),n.close()},g=function(t){var n=JSON.parse(t.data);n.session_id==u.session_id&&n.transaction==u.transaction&&(f(),i.success(),c&&e.destroyed())},m=function(t){f(),i.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return n.addEventListener("message",g),n.addEventListener("error",m),void n.send(JSON.stringify(u))}ie.httpAPICall(s+"/"+y,{verb:"POST",async:a,withCredentials:v,body:u,success:function(t){ie.log("Destroyed session:"),ie.debug(t),y=null,w=!1,"success"!==t["janus"]&&ie.error("Ooops: "+t["error"].code+" "+t["error"].reason),i.success(),c&&e.destroyed()},error:function(t,n){ie.error(t+":",n),y=null,w=!1,i.success(),c&&e.destroyed()}})}function j(e){if(e=e||{},e.success="function"==typeof e.success?e.success:ie.noop,e.error="function"==typeof e.error?e.error:ie.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:ie.noop,e.iceState="function"==typeof e.iceState?e.iceState:ie.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:ie.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:ie.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:ie.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:ie.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:ie.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:ie.noop,e.ondata="function"==typeof e.ondata?e.ondata:ie.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:ie.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:ie.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:ie.noop,!w)return ie.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var r=e.plugin;if(void 0===r||null===r)return ie.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.token?e.token:p,a=ie.randomString(12),c={janus:"attach",plugin:r,opaque_id:o,transaction:a};if(null!==i&&void 0!==i&&(c["token"]=i),null!==h&&void 0!==h&&(c["apisecret"]=h),t)return T[a]=function(t){if(ie.debug(t),"success"!==t["janus"])return ie.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var n=t.data["id"];ie.log("Created handle: "+n);var o={session:k,plugin:r,id:n,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return r},getVolume:function(){return B(n,!0)},getRemoteVolume:function(){return B(n,!0)},getLocalVolume:function(){return B(n,!1)},isAudioMuted:function(){return q(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return q(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return Y(n)},send:function(e){I(n,e)},data:function(e){M(n,e)},dtmf:function(e){P(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(n,!0,e)},createAnswer:function(e){U(n,!1,e)},handleRemoteJsep:function(e){N(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){X(n,!0===e)},detach:function(e){L(n,e)}};S[n]=o,e.success(o)},c["session_id"]=y,void n.send(JSON.stringify(c));ie.httpAPICall(s+"/"+y,{verb:"POST",withCredentials:v,body:c,success:function(t){if(ie.debug(t),"success"!==t["janus"])return ie.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var n=t.data["id"];ie.log("Created handle: "+n);var o={session:k,plugin:r,id:n,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return n},getPlugin:function(){return r},getVolume:function(){return B(n,!0)},getRemoteVolume:function(){return B(n,!0)},getLocalVolume:function(){return B(n,!1)},isAudioMuted:function(){return q(n,!1)},muteAudio:function(){return W(n,!1,!0)},unmuteAudio:function(){return W(n,!1,!1)},isVideoMuted:function(){return q(n,!0)},muteVideo:function(){return W(n,!0,!0)},unmuteVideo:function(){return W(n,!0,!1)},getBitrate:function(){return Y(n)},send:function(e){I(n,e)},data:function(e){M(n,e)},dtmf:function(e){P(n,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(n,!0,e)},createAnswer:function(e){U(n,!1,e)},handleRemoteJsep:function(e){N(n,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){X(n,!0===e)},detach:function(e){L(n,e)}};S[n]=o,e.success(o)},error:function(e,t){ie.error(e+":",t)}})}function I(e,r){if(r=r||{},r.success="function"==typeof r.success?r.success:ie.noop,r.error="function"==typeof r.error?r.error:ie.noop,!w)return ie.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var o=S[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return ie.warn("Invalid handle"),void r.error("Invalid handle");var i=r.message,a=r.jsep,c=ie.randomString(12),d={janus:"message",body:i,transaction:c};if(null!==o.token&&void 0!==o.token&&(d["token"]=o.token),null!==h&&void 0!==h&&(d["apisecret"]=h),null!==a&&void 0!==a&&(d.jsep=a),ie.debug("Sending message to plugin (handle="+e+"):"),ie.debug(d),t)return d["session_id"]=y,d["handle_id"]=e,T[c]=function(e){if(ie.debug("Message sent!"),ie.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(void 0===t||null===t)return ie.warn("Request succeeded, but missing plugindata..."),void r.success();ie.log("Synchronous transaction successful ("+t["plugin"]+")");var n=t["data"];return ie.debug(n),void r.success(n)}"ack"===e["janus"]?r.success():void 0!==e["error"]&&null!==e["error"]?(ie.error("Ooops: "+e["error"].code+" "+e["error"].reason),r.error(e["error"].code+" "+e["error"].reason)):(ie.error("Unknown error"),r.error("Unknown error"))},void n.send(JSON.stringify(d));ie.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:v,body:d,success:function(e){if(ie.debug("Message sent!"),ie.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(void 0===t||null===t)return ie.warn("Request succeeded, but missing plugindata..."),void r.success();ie.log("Synchronous transaction successful ("+t["plugin"]+")");var n=t["data"];return ie.debug(n),void r.success(n)}"ack"===e["janus"]?r.success():void 0!==e["error"]&&null!==e["error"]?(ie.error("Ooops: "+e["error"].code+" "+e["error"].reason),r.error(e["error"].code+" "+e["error"].reason)):(ie.error("Unknown error"),r.error("Unknown error"))},error:function(e,t){ie.error(e+":",t),r.error(e+": "+t)}})}function x(e,r){if(w){var o=S[e];if(null!==o&&void 0!==o&&null!==o.webrtcStuff&&void 0!==o.webrtcStuff){var i={janus:"trickle",candidate:r,transaction:ie.randomString(12)};if(null!==o.token&&void 0!==o.token&&(i["token"]=o.token),null!==h&&void 0!==h&&(i["apisecret"]=h),ie.vdebug("Sending trickle candidate (handle="+e+"):"),ie.vdebug(i),t)return i["session_id"]=y,i["handle_id"]=e,void n.send(JSON.stringify(i));ie.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:v,body:i,success:function(e){ie.vdebug("Candidate sent!"),ie.vdebug(e),"ack"===e["janus"]||ie.error("Ooops: "+e["error"].code+" "+e["error"].reason)},error:function(e,t){ie.error(e+":",t)}})}else ie.warn("Invalid handle")}else ie.warn("Is the server down? (connected=false)")}function E(e,t,n,r){var o=S[e];if(null!==o&&void 0!==o&&null!==o.webrtcStuff&&void 0!==o.webrtcStuff){var i=o.webrtcStuff,a=function(e){ie.log("Received message on data channel:",e);var t=e.target.label;o.ondata(e.data,t)},s=function(e){ie.log("Received state change on data channel:",e);var t=e.target.label,n=i.dataChannel[t]?i.dataChannel[t].readyState:"null";if(ie.log("State change on <"+t+"> data channel: "+n),"open"===n){if(i.dataChannel[t].pending&&i.dataChannel[t].pending.length>0){for(var r in ie.log("Sending pending messages on <"+t+">:",i.dataChannel[t].pending.length),i.dataChannel[t].pending){var a=i.dataChannel[t].pending[r];ie.log("Sending string on data channel <"+t+">: "+a),i.dataChannel[t].send(a)}i.dataChannel[t].pending=[]}o.ondataopen(t)}},c=function(e){ie.error("Got error on data channel:",e)};i.dataChannel[t]=n||i.pc.createDataChannel(t,{ordered:!1}),i.dataChannel[t].onmessage=a,i.dataChannel[t].onopen=s,i.dataChannel[t].onclose=s,i.dataChannel[t].onerror=c,i.dataChannel[t].pending=[],r&&i.dataChannel[t].pending.push(r)}else ie.warn("Invalid handle")}function M(e,t){t=t||{},t.success="function"==typeof t.success?t.success:ie.noop,t.error="function"==typeof t.error?t.error:ie.noop;var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return ie.warn("Invalid handle"),void t.error("Invalid handle");var r=n.webrtcStuff,o=t.text;if(null===o||void 0===o)return ie.warn("Invalid text"),void t.error("Invalid text");var i=t.label?t.label:ie.dataChanDefaultLabel;return r.dataChannel[i]?"open"!==r.dataChannel[i].readyState?(r.dataChannel[i].pending.push(o),void t.success()):(ie.log("Sending string on data channel <"+i+">: "+o),r.dataChannel[i].send(o),void t.success()):(E(e,i,!1,o),void t.success())}function P(e,t){t=t||{},t.success="function"==typeof t.success?t.success:ie.noop,t.error="function"==typeof t.error?t.error:ie.noop;var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return ie.warn("Invalid handle"),void t.error("Invalid handle");var r=n.webrtcStuff;if(null===r.dtmfSender||void 0===r.dtmfSender){if(void 0!==r.pc&&null!==r.pc){var o=r.pc.getSenders(),i=o.find((function(e){return e.track&&"audio"===e.track.kind}));if(!i)return ie.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");r.dtmfSender=i.dtmf,r.dtmfSender&&(ie.log("Created DTMF Sender"),r.dtmfSender.ontonechange=function(e){ie.debug("Sent DTMF tone: "+e.tone)})}if(null===r.dtmfSender||void 0===r.dtmfSender)return ie.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var a=t.dtmf;if(null===a||void 0===a)return ie.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var s=a.tones;if(null===s||void 0===s)return ie.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var c=a.duration;null!==c&&void 0!==c||(c=500);var d=a.gap;null!==d&&void 0!==d||(d=50),ie.debug("Sending DTMF string "+s+" (duration "+c+"ms, gap "+d+"ms)"),r.dtmfSender.insertDTMF(s,c,d),t.success()}function L(e,r){r=r||{},r.success="function"==typeof r.success?r.success:ie.noop,r.error="function"==typeof r.error?r.error:ie.noop;var o=!0;void 0!==r.asyncRequest&&null!==r.asyncRequest&&(o=!0===r.asyncRequest);var i=!0;void 0!==r.noRequest&&null!==r.noRequest&&(i=!0===r.noRequest),ie.log("Destroying handle "+e+" (async="+o+")"),X(e);var a=S[e];if(null===a||void 0===a||a.detached)return delete S[e],void r.success();if(i)return delete S[e],void r.success();if(!w)return ie.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var c={janus:"detach",transaction:ie.randomString(12)};if(null!==a.token&&void 0!==a.token&&(c["token"]=a.token),null!==h&&void 0!==h&&(c["apisecret"]=h),t)return c["session_id"]=y,c["handle_id"]=e,n.send(JSON.stringify(c)),delete S[e],void r.success();ie.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",async:o,withCredentials:v,body:c,success:function(t){ie.log("Destroyed handle:"),ie.debug(t),"success"!==t["janus"]&&ie.error("Ooops: "+t["error"].code+" "+t["error"].reason),delete S[e],r.success()},error:function(t,n){ie.error(t+":",n),delete S[e],r.success()}})}function V(e,t,n,r,o){var i=S[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return ie.warn("Invalid handle"),void r.error("Invalid handle");var a=i.webrtcStuff;ie.debug("streamsDone:",o),o&&(ie.debug("  -- Audio tracks:",o.getAudioTracks()),ie.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(a.myStream&&n.update&&!a.streamExternal){if((!n.update&&G(n)||n.update&&(n.addAudio||n.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(a.myStream.addTrack(o.getAudioTracks()[0]),ie.unifiedPlan){ie.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var v=null,f=a.pc.getTransceivers();if(f&&f.length>0)for(var p in f){var h=f[p];if(h.sender&&h.sender.track&&"audio"===h.sender.track.kind||h.receiver&&h.receiver.track&&"audio"===h.receiver.track.kind){v=h;break}}v&&v.sender?v.sender.replaceTrack(o.getAudioTracks()[0]):a.pc.addTrack(o.getAudioTracks()[0],o)}else ie.log((n.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),a.pc.addTrack(o.getAudioTracks()[0],o);if((!n.update&&Z(n)||n.update&&(n.addVideo||n.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(a.myStream.addTrack(o.getVideoTracks()[0]),ie.unifiedPlan){ie.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var g=null;f=a.pc.getTransceivers();if(f&&f.length>0)for(var p in f){h=f[p];if(h.sender&&h.sender.track&&"video"===h.sender.track.kind||h.receiver&&h.receiver.track&&"video"===h.receiver.track.kind){g=h;break}}g&&g.sender?g.sender.replaceTrack(o.getVideoTracks()[0]):a.pc.addTrack(o.getVideoTracks()[0],o)}else ie.log((n.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),a.pc.addTrack(o.getVideoTracks()[0],o)}else a.myStream=o,s=!0;if(!a.pc){var m={iceServers:c,iceTransportPolicy:d,bundlePolicy:l};"chrome"===ie.webRTCAdapter.browserDetails.browser&&(m["sdpSemantics"]=ie.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var w={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===u&&w.optional.push({googIPv6:!0}),r.rtcConstraints&&"object"===Object(ne["a"])(r.rtcConstraints))for(var p in ie.debug("Adding custom PeerConnection constraints:",r.rtcConstraints),r.rtcConstraints)w.optional.push(r.rtcConstraints[p]);"edge"===ie.webRTCAdapter.browserDetails.browser&&(m.bundlePolicy="max-bundle"),ie.log("Creating PeerConnection"),ie.debug(w),a.pc=new RTCPeerConnection(m,w),ie.debug(a.pc),a.pc.getStats&&(a.volume={},a.bitrate.value="0 kbits/sec"),ie.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(e){a.pc&&i.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(t){if(null==t.candidate||"edge"===ie.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)ie.log("End of candidates."),a.iceDone=!0,!0===a.trickle?x(e,{completed:!0}):$(e,r);else{var n={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===a.trickle&&x(e,n)}},a.pc.ontrack=function(e){ie.log("Handling Remote Track"),ie.debug(e),e.streams&&(a.remoteStream=e.streams[0],i.onremotestream(a.remoteStream),e.track.onended||(ie.log("Adding onended callback to track:",e.track),e.track.onended=function(e){ie.log("Remote track muted/removed:",e),a.remoteStream&&(a.remoteStream.removeTrack(e.target),i.onremotestream(a.remoteStream))},e.track.onmute=e.track.onended,e.track.onunmute=function(e){ie.log("Remote track flowing again:",e);try{a.remoteStream.addTrack(e.target),i.onremotestream(a.remoteStream)}catch(t){ie.error(t)}}))}}if(s&&null!==o&&void 0!==o){ie.log("Adding local stream");var y=!0===r.simulcast2;o.getTracks().forEach((function(e){if(ie.log("Adding local track:",e),y)if("audio"===e.kind)a.pc.addTrack(e,o);else{ie.log("Enabling rid-based simulcasting:",e);var t=b(r.simulcastMaxBitrates);a.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:t.high},{rid:"m",active:!0,maxBitrate:t.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:t.low,scaleResolutionDownBy:4}]})}else a.pc.addTrack(e,o)}))}oe(n)&&!a.dataChannel[ie.dataChanDefaultLabel]&&(ie.log("Creating data channel"),E(e,ie.dataChanDefaultLabel,!1),a.pc.ondatachannel=function(t){ie.log("Data channel created by Janus:",t),E(e,t.channel.label,t.channel)}),a.myStream&&i.onlocalstream(a.myStream),null===t||void 0===t?J(e,n,r):a.pc.setRemoteDescription(t).then((function(){if(ie.log("Remote description accepted!"),a.remoteSdp=t.sdp,a.candidates&&a.candidates.length>0){for(var o=0;o<a.candidates.length;o++){var i=a.candidates[o];ie.debug("Adding remote candidate:",i),i&&!0!==i.completed?a.pc.addIceCandidate(i):a.pc.addIceCandidate(ie.endOfCandidates)}a.candidates=[]}F(e,n,r)}),r.error)}function U(e,t,n){n=n||{},n.success="function"==typeof n.success?n.success:ie.noop,n.error="function"==typeof n.error?n.error:z;var r=n.jsep;if(t&&r)return ie.error("Provided a JSEP to a createOffer"),void n.error("Provided a JSEP to a createOffer");if(!t&&(!r||!r.type||!r.sdp))return ie.error("A valid JSEP is required for createAnswer"),void n.error("A valid JSEP is required for createAnswer");n.media=n.media||{audio:!0,video:!0};var o=n.media,i=S[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return ie.warn("Invalid handle"),void n.error("Invalid handle");var a=i.webrtcStuff;if(a.trickle=ae(n.trickle),void 0===a.pc||null===a.pc)o.update=!1,o.keepAudio=!1,o.keepVideo=!1;else if(void 0!==a.pc&&null!==a.pc){if(ie.log("Updating existing media session"),o.update=!0,null!==n.stream&&void 0!==n.stream)n.stream!==a.myStream&&ie.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return ie.error("Can't add audio stream, there already is one"),void n.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(null===a.myStream||void 0===a.myStream?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),G(o)&&(o.keepAudio=!1,o.addAudio=!0)):null===a.myStream.getAudioTracks()||void 0===a.myStream.getAudioTracks()||0===a.myStream.getAudioTracks().length?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),G(o)&&(o.keepVideo=!1,o.addAudio=!0)):!G(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return ie.error("Can't add video stream, there already is one"),void n.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);null===a.myStream||void 0===a.myStream?(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Z(o)&&(o.keepVideo=!1,o.addVideo=!0)):null===a.myStream.getVideoTracks()||void 0===a.myStream.getVideoTracks()||0===a.myStream.getVideoTracks().length?(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Z(o)&&(o.keepVideo=!1,o.addVideo=!0)):!Z(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0),o.addData&&(o.data=!0)}if(G(o)&&o.keepAudio&&Z(o)&&o.keepVideo)return i.consentDialog(!1),void V(e,r,o,n,a.myStream)}if(o.update&&!a.streamExternal){if(o.removeAudio||o.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var s=a.myStream.getAudioTracks()[0];ie.log("Removing audio track:",s),a.myStream.removeTrack(s);try{s.stop()}catch(A){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var c=!0;if(o.replaceAudio&&ie.unifiedPlan&&(c=!1),c)for(var d in a.pc.getSenders()){s=a.pc.getSenders()[d];s&&s.track&&"audio"===s.track.kind&&(ie.log("Removing audio sender:",s),a.pc.removeTrack(s))}}}if(o.removeVideo||o.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){s=a.myStream.getVideoTracks()[0];ie.log("Removing video track:",s),a.myStream.removeTrack(s);try{s.stop()}catch(A){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var l=!0;if(o.replaceVideo&&ie.unifiedPlan&&(l=!1),l)for(var d in a.pc.getSenders()){s=a.pc.getSenders()[d];s&&s.track&&"video"===s.track.kind&&(ie.log("Removing video sender:",s),a.pc.removeTrack(s))}}}}if(null!==n.stream&&void 0!==n.stream){var u=n.stream;if(ie.log("MediaStream provided by the application"),ie.debug(u),o.update&&a.myStream&&a.myStream!==n.stream&&!a.streamExternal){try{var v=a.myStream.getTracks();for(var f in v){var p=v[f];ie.log(p),null!==p&&void 0!==p&&p.stop()}}catch(A){}a.myStream=null}return a.streamExternal=!0,i.consentDialog(!1),void V(e,r,o,n,u)}if(G(o)||Z(o)){if(!ie.isGetUserMediaAvailable())return void n.error("getUserMedia not available");var h={mandatory:{},optional:[]};i.consentDialog(!0);var g=G(o);!0===g&&void 0!=o&&null!=o&&"object"===Object(ne["a"])(o.audio)&&(g=o.audio);var m=Z(o);if(!0===m&&void 0!=o&&null!=o){var b=!0===n.simulcast,w=!0===n.simulcast2;if(!b&&!w||r||void 0!==o.video&&!1!==o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===Object(ne["a"])(o.video))m=o.video;else{var y=0,k=0;"lowres"===o.video?(k=240,240,y=320):"lowres-16:9"===o.video?(k=180,180,y=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(k=720,720,y=1280):"fhdres"===o.video?(k=1080,1080,y=1920):"4kres"===o.video?(k=2160,2160,y=3840):"stdres"===o.video?(k=480,480,y=640):"stdres-16:9"===o.video?(k=360,360,y=640):(ie.log("Default video setting is stdres 4:3"),k=480,480,y=640),ie.log("Adding media constraint:",o.video),m={height:{ideal:k},width:{ideal:y}},ie.log("Adding video constraint:",m)}else if("screen"===o.video||"window"===o.video){var _=function(t,a){i.consentDialog(!1),t?n.error(t):V(e,r,o,n,a)},T=function(e,t,n){ie.log("Adding media constraint (screen capture)"),ie.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){n?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){e.addTrack(n.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){i.consentDialog(!1),t(e)}))};if(o.screenshareFrameRate||(o.screenshareFrameRate=3),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return void navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(t){i.consentDialog(!1),G(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){t.addTrack(i.getAudioTracks()[0]),V(e,r,o,n,t)})):V(e,r,o,n,t)}),(function(e){i.consentDialog(!1),n.error(e)}));if("chrome"===ie.webRTCAdapter.browserDetails.browser){var C=ie.webRTCAdapter.browserDetails.version,R=33;window.navigator.userAgent.match("Linux")&&(R=35),C>=26&&C<=R?(h={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:G(o)&&!o.keepAudio},T(h,_)):ie.extension.getScreen((function(e,t){if(e)return i.consentDialog(!1),n.error(e);h={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},h.video.mandatory.chromeMediaSourceId=t,T(h,_,G(o)&&!o.keepAudio)}))}else if("firefox"===ie.webRTCAdapter.browserDetails.browser){if(!(ie.webRTCAdapter.browserDetails.version>=33)){var D=new Error("NavigatorUserMediaError");return D.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void n.error(D)}h={video:{mozMediaSource:o.video,mediaSource:o.video},audio:G(o)&&!o.keepAudio},T(h,(function(e,t){if(_(e,t),!e)var n=t.currentTime,r=window.setInterval((function(){t||window.clearInterval(r),t.currentTime==n&&(window.clearInterval(r),t.onended&&t.onended()),n=t.currentTime}),500)}))}return}}null!==o&&void 0!==o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(t){var a=t.some((function(e){return"audioinput"===e.kind})),s=re(o)||t.some((function(e){return"videoinput"===e.kind})),c=G(o),d=Z(o),l=K(o),v=ee(o);if(c||d||l||v){var f=!!c&&a,p=!!d&&s;if(!f&&!p)return i.consentDialog(!1),n.error("No capture device found"),!1;if(!f&&l)return i.consentDialog(!1),n.error("Audio capture is required, but no capture device found"),!1;if(!p&&v)return i.consentDialog(!1),n.error("Video capture is required, but no capture device found"),!1}var h={audio:!(!a||o.keepAudio)&&g,video:!(!s||o.keepVideo)&&m};ie.debug("getUserMedia constraints",h),h.audio||h.video?navigator.mediaDevices.getUserMedia(h).then((function(t){i.consentDialog(!1),V(e,r,o,n,t)})).catch((function(e){i.consentDialog(!1),n.error({code:e.code,name:e.name,message:e.message})})):(i.consentDialog(!1),V(e,r,o,n,u))})).catch((function(e){i.consentDialog(!1),n.error("enumerateDevices error",e)}))}else V(e,r,o,n)}function N(e,t){t=t||{},t.success="function"==typeof t.success?t.success:ie.noop,t.error="function"==typeof t.error?t.error:z;var n=t.jsep,r=S[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return ie.warn("Invalid handle"),void t.error("Invalid handle");var o=r.webrtcStuff;if(void 0!==n&&null!==n){if(null===o.pc)return ie.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(n).then((function(){if(ie.log("Remote description accepted!"),o.remoteSdp=n.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var r=o.candidates[e];ie.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(ie.endOfCandidates)}o.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function J(e,t,n){n=n||{},n.success="function"==typeof n.success?n.success:ie.noop,n.error="function"==typeof n.error?n.error:ie.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:ie.noop;var r=S[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return ie.warn("Invalid handle"),void n.error("Invalid handle");var o=r.webrtcStuff,i=!0===n.simulcast;i?ie.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):ie.log("Creating offer (iceDone="+o.iceDone+")");var a={};if(ie.unifiedPlan){var s=null,c=null,d=o.pc.getTransceivers();if(d&&d.length>0)for(var l in d){var u=d[l];u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?s||(s=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(c||(c=u))}var v=G(t),f=Q(t);v||f?v&&f?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",ie.log("Setting audio transceiver to sendrecv:",s)):v&&!f?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",ie.log("Setting audio transceiver to sendonly:",s)):!v&&f&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",ie.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),ie.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",ie.log("Setting audio transceiver to inactive:",s));var p=Z(t),h=te(t);p||h?p&&h?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",ie.log("Setting video transceiver to sendrecv:",c)):p&&!h?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",ie.log("Setting video transceiver to sendonly:",c)):!p&&h&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",ie.log("Setting video transceiver to recvonly:",c)):(c=o.pc.addTransceiver("video",{direction:"recvonly"}),ie.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",ie.log("Setting video transceiver to inactive:",c))}else a["offerToReceiveAudio"]=Q(t),a["offerToReceiveVideo"]=te(t);var g=!0===n.iceRestart;g&&(a["iceRestart"]=!0),ie.debug(a);var m=Z(t);if(m&&i&&"firefox"===ie.webRTCAdapter.browserDetails.browser){ie.log("Enabling Simulcasting for Firefox (RID)");var w=o.pc.getSenders().find((function(e){return"video"==e.track.kind}));if(w){var y=w.getParameters();y||(y={});var k=b(n.simulcastMaxBitrates);y.encodings=[{rid:"h",active:!0,maxBitrate:k.high},{rid:"m",active:!0,maxBitrate:k.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:k.low,scaleResolutionDownBy:4}],w.setParameters(y)}}o.pc.createOffer(a).then((function(e){ie.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,ie.log("Setting local description"),m&&i&&("chrome"===ie.webRTCAdapter.browserDetails.browser||"safari"===ie.webRTCAdapter.browserDetails.browser?(ie.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=H(e.sdp)):"firefox"!==ie.webRTCAdapter.browserDetails.browser&&ie.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(n.error),o.mediaConstraints=a,o.iceDone||o.trickle?(ie.log("Offer ready"),ie.debug(n),n.success(e)):ie.log("Waiting for all candidates...")}),n.error)}function F(e,t,n){n=n||{},n.success="function"==typeof n.success?n.success:ie.noop,n.error="function"==typeof n.error?n.error:ie.noop,n.customizeSdp="function"==typeof n.customizeSdp?n.customizeSdp:ie.noop;var r=S[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return ie.warn("Invalid handle"),void n.error("Invalid handle");var o=r.webrtcStuff,i=!0===n.simulcast;i?ie.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):ie.log("Creating answer (iceDone="+o.iceDone+")");var a=null;if(ie.unifiedPlan){a={};var s=null,c=null,d=o.pc.getTransceivers();if(d&&d.length>0)for(var l in d){var u=d[l];u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?s||(s=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(c||(c=u))}var v=G(t),f=Q(t);if(v||f){if(v&&f){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",ie.log("Setting audio transceiver to sendrecv:",s)}catch(k){ie.error(k)}}else if(v&&!f)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",ie.log("Setting audio transceiver to sendonly:",s))}catch(k){ie.error(k)}else if(!v&&f)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",ie.log("Setting audio transceiver to recvonly:",s)}catch(k){ie.error(k)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),ie.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",ie.log("Setting audio transceiver to inactive:",s)}catch(k){ie.error(k)}var p=Z(t),h=te(t);if(p||h){if(p&&h){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",ie.log("Setting video transceiver to sendrecv:",c)}catch(k){ie.error(k)}}else if(p&&!h){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",ie.log("Setting video transceiver to sendonly:",c)}catch(k){ie.error(k)}}else if(!p&&h)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",ie.log("Setting video transceiver to recvonly:",c)}catch(k){ie.error(k)}else c=o.pc.addTransceiver("video",{direction:"recvonly"}),ie.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",ie.log("Setting video transceiver to inactive:",c)}catch(k){ie.error(k)}}else a="firefox"==ie.webRTCAdapter.browserDetails.browser||"edge"==ie.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:Q(t),offerToReceiveVideo:te(t)}:{mandatory:{OfferToReceiveAudio:Q(t),OfferToReceiveVideo:te(t)}};ie.debug(a);var g=Z(t);if(g&&i&&"firefox"===ie.webRTCAdapter.browserDetails.browser){ie.log("Enabling Simulcasting for Firefox (RID)");var m=o.pc.getSenders()[1];ie.log(m);var w=m.getParameters();ie.log(w);var y=b(n.simulcastMaxBitrates);m.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:y.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:y.medium},{rid:"low",active:!0,priority:"low",maxBitrate:y.low}]})}o.pc.createAnswer(a).then((function(e){ie.debug(e);var t={type:e.type,sdp:e.sdp};n.customizeSdp(t),e.sdp=t.sdp,ie.log("Setting local description"),g&&i&&("chrome"===ie.webRTCAdapter.browserDetails.browser?ie.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==ie.webRTCAdapter.browserDetails.browser&&ie.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(n.error),o.mediaConstraints=a,o.iceDone||o.trickle?n.success(e):ie.log("Waiting for all candidates...")}),n.error)}function $(e,t){t=t||{},t.success="function"==typeof t.success?t.success:ie.noop,t.error="function"==typeof t.error?t.error:ie.noop;var n=S[e];if(null!==n&&void 0!==n&&null!==n.webrtcStuff&&void 0!==n.webrtcStuff){var r=n.webrtcStuff;ie.log("Sending offer/answer SDP..."),null!==r.mySdp&&void 0!==r.mySdp?(r.mySdp={type:r.pc.localDescription.type,sdp:r.pc.localDescription.sdp},!1===r.trickle&&(r.mySdp["trickle"]=!1),ie.debug(t),r.sdpSent=!0,t.success(r.mySdp)):ie.warn("Local SDP instance is invalid, not sending anything...")}else ie.warn("Invalid handle, not sending anything")}function B(e,t){var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return ie.warn("Invalid handle"),0;var r=t?"remote":"local",o=n.webrtcStuff;return o.volume[r]||(o.volume[r]={value:0}),o.pc.getStats&&"chrome"===ie.webRTCAdapter.browserDetails.browser?!t||null!==o.remoteStream&&void 0!==o.remoteStream?t||null!==o.myStream&&void 0!==o.myStream?null===o.volume[r].timer||void 0===o.volume[r].timer?(ie.log("Starting "+r+" volume monitor"),o.volume[r].timer=setInterval((function(){o.pc.getStats((function(e){for(var n=e.result(),i=0;i<n.length;i++){var a=n[i];"ssrc"==a.type&&(t&&a.stat("audioOutputLevel")?o.volume[r].value=parseInt(a.stat("audioOutputLevel")):!t&&a.stat("audioInputLevel")&&(o.volume[r].value=parseInt(a.stat("audioInputLevel"))))}}))}),200),0):o.volume[r].value:(ie.warn("Local stream unavailable"),0):(ie.warn("Remote stream unavailable"),0):(ie.warn("Getting the "+r+" volume unsupported by browser"),0)}function q(e,t){var n=S[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return ie.warn("Invalid handle"),!0;var r=n.webrtcStuff;return null===r.pc||void 0===r.pc?(ie.warn("Invalid PeerConnection"),!0):void 0===r.myStream||null===r.myStream?(ie.warn("Invalid local MediaStream"),!0):t?null===r.myStream.getVideoTracks()||void 0===r.myStream.getVideoTracks()||0===r.myStream.getVideoTracks().length?(ie.warn("No video track"),!0):!r.myStream.getVideoTracks()[0].enabled:null===r.myStream.getAudioTracks()||void 0===r.myStream.getAudioTracks()||0===r.myStream.getAudioTracks().length?(ie.warn("No audio track"),!0):!r.myStream.getAudioTracks()[0].enabled}function W(e,t,n){var r=S[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return ie.warn("Invalid handle"),!1;var o=r.webrtcStuff;return null===o.pc||void 0===o.pc?(ie.warn("Invalid PeerConnection"),!1):void 0===o.myStream||null===o.myStream?(ie.warn("Invalid local MediaStream"),!1):t?null===o.myStream.getVideoTracks()||void 0===o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length?(ie.warn("No video track"),!1):(o.myStream.getVideoTracks()[0].enabled=!n,!0):null===o.myStream.getAudioTracks()||void 0===o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length?(ie.warn("No audio track"),!1):(o.myStream.getAudioTracks()[0].enabled=!n,!0)}function Y(e){var t=S[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return ie.warn("Invalid handle"),"Invalid handle";var n=t.webrtcStuff;return null===n.pc||void 0===n.pc?"Invalid PeerConnection":n.pc.getStats?null===n.bitrate.timer||void 0===n.bitrate.timer?(ie.log("Starting bitrate timer (via getStats)"),n.bitrate.timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(n.bitrate.bsnow=e.bytesReceived,n.bitrate.tsnow=e.timestamp,null===n.bitrate.bsbefore||null===n.bitrate.tsbefore)n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow;else{var r=n.bitrate.tsnow-n.bitrate.tsbefore;"safari"==ie.webRTCAdapter.browserDetails.browser&&(r/=1e3);var o=Math.round(8*(n.bitrate.bsnow-n.bitrate.bsbefore)/r);"safari"===ie.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),n.bitrate.value=o+" kbits/sec",n.bitrate.bsbefore=n.bitrate.bsnow,n.bitrate.tsbefore=n.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):n.bitrate.value:(ie.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function z(e){ie.error("WebRTC error:",e)}function X(e,r){ie.log("Cleaning WebRTC stuff");var o=S[e];if(null!==o&&void 0!==o){var i=o.webrtcStuff;if(null!==i&&void 0!==i){if(!0===r){var a={janus:"hangup",transaction:ie.randomString(12)};null!==o.token&&void 0!==o.token&&(a["token"]=o.token),null!==h&&void 0!==h&&(a["apisecret"]=h),ie.debug("Sending hangup request (handle="+e+"):"),ie.debug(a),t?(a["session_id"]=y,a["handle_id"]=e,n.send(JSON.stringify(a))):ie.httpAPICall(s+"/"+y+"/"+e,{verb:"POST",withCredentials:v,body:a})}i.remoteStream=null,i.volume&&(i.volume["local"]&&i.volume["local"].timer&&clearInterval(i.volume["local"].timer),i.volume["remote"]&&i.volume["remote"].timer&&clearInterval(i.volume["remote"].timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null;try{if(!i.streamExternal&&null!==i.myStream&&void 0!==i.myStream){ie.log("Stopping local stream tracks");var c=i.myStream.getTracks();for(var d in c){var l=c[d];ie.log(l),null!==l&&void 0!==l&&l.stop()}}}catch(u){}i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(u){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null}o.oncleanup()}}function H(e){for(var t=e.split("\r\n"),n=!1,r=[-1],o=[-1],i=null,a=null,s=null,c=null,d=-1,l=0;l<t.length;l++){var u=t[l].match(/m=(\w+) */);if(u){var v=u[1];if("video"===v){if(!(r[0]<0)){d=l;break}n=!0}else if(r[0]>-1){d=l;break}}else if(n){var f=t[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)r[0]=f[1],o[0]=f[2],t.splice(l,1),l--;else{if(r[0]){var p=t[l].match("a=ssrc:"+r[0]+" cname:(.+)");if(p&&(i=p[1]),p=t[l].match("a=ssrc:"+r[0]+" msid:(.+)"),p&&(a=p[1]),p=t[l].match("a=ssrc:"+r[0]+" mslabel:(.+)"),p&&(s=p[1]),p=t[l].match("a=ssrc:"+r[0]+" label:(.+)"),p&&(c=p[1]),0===t[l].indexOf("a=ssrc:"+o[0])){t.splice(l,1),l--;continue}if(0===t[l].indexOf("a=ssrc:"+r[0])){t.splice(l,1),l--;continue}}0!=t[l].length||(t.splice(l,1),l--)}}}if(r[0]<0){d=-1,n=!1;for(l=0;l<t.length;l++){u=t[l].match(/m=(\w+) */);if(u){v=u[1];if("video"===v){if(!(r[0]<0)){d=l;break}n=!0}else if(r[0]>-1){d=l;break}}else if(n){if(r[0]<0){var h=t[l].match(/a=ssrc:(\d+)/);if(h){r[0]=h[1],t.splice(l,1),l--;continue}}else{p=t[l].match("a=ssrc:"+r[0]+" cname:(.+)");if(p&&(i=p[1]),p=t[l].match("a=ssrc:"+r[0]+" msid:(.+)"),p&&(a=p[1]),p=t[l].match("a=ssrc:"+r[0]+" mslabel:(.+)"),p&&(s=p[1]),p=t[l].match("a=ssrc:"+r[0]+" label:(.+)"),p&&(c=p[1]),0===t[l].indexOf("a=ssrc:"+o[0])){t.splice(l,1),l--;continue}if(0===t[l].indexOf("a=ssrc:"+r[0])){t.splice(l,1),l--;continue}}0!=t[l].length||(t.splice(l,1),l--)}}}if(r[0]<0)return ie.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;d<0&&(d=t.length),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(l=0;l<r.length;l++)i&&(t.splice(d,0,"a=ssrc:"+r[l]+" cname:"+i),d++),a&&(t.splice(d,0,"a=ssrc:"+r[l]+" msid:"+a),d++),s&&(t.splice(d,0,"a=ssrc:"+r[l]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+r[l]+" label:"+c),d++),i&&(t.splice(d,0,"a=ssrc:"+o[l]+" cname:"+i),d++),a&&(t.splice(d,0,"a=ssrc:"+o[l]+" msid:"+a),d++),s&&(t.splice(d,0,"a=ssrc:"+o[l]+" mslabel:"+s),d++),c&&(t.splice(d,0,"a=ssrc:"+o[l]+" label:"+c),d++);return t.splice(d,0,"a=ssrc-group:FID "+r[2]+" "+o[2]),t.splice(d,0,"a=ssrc-group:FID "+r[1]+" "+o[1]),t.splice(d,0,"a=ssrc-group:FID "+r[0]+" "+o[0]),t.splice(d,0,"a=ssrc-group:SIM "+r[0]+" "+r[1]+" "+r[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function G(e){return ie.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function K(e){return ie.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function Q(e){return ie.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function Z(e){return ie.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function ee(e){return ie.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function te(e){return ie.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function re(e){if(ie.debug("isScreenSendEnabled:",e),void 0===e||null===e)return!1;if("object"!==Object(ne["a"])(e.video)||"object"!==Object(ne["a"])(e.video.mandatory))return!1;var t=e.video.mandatory;return t.chromeMediaSource?"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource:t.mozMediaSource?"window"===t.mozMediaSource||"screen"===t.mozMediaSource:!!t.mediaSource&&("window"===t.mediaSource||"screen"===t.mediaSource)}function oe(e){return ie.debug("isDataEnabled:",e),"edge"==ie.webRTCAdapter.browserDetails.browser?(ie.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function ae(e){return ie.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}A(e),this.getServer=function(){return s},this.isConnected=function(){return w},this.reconnect=function(e){e=e||{},e.success="function"==typeof e.success?e.success:ie.noop,e.error="function"==typeof e.error?e.error:ie.noop,e["reconnect"]=!0,A(e)},this.getSessionId=function(){return y},this.destroy=function(e){O(e)},this.attach=function(e){j(e)}}ie.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,n=e&&e.Promise||Promise,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},extension:e&&e.extension||oe,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||re["a"],httpAPICall:function(e,r){var o={method:r.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===r.verb&&(o.headers["Content-Type"]="application/json"),void 0!==r.withCredentials&&(o.credentials=!0===r.withCredentials?"include":r.withCredentials?r.withCredentials:"omit"),void 0!==r.body&&(o.body=JSON.stringify(r.body));var i=t(e,o).catch((function(e){return n.reject({message:"Probably a network error, is the server down?",error:e})}));if(void 0!==r.timeout){var a=new n((function(e,t){var n=setTimeout((function(){return clearTimeout(n),t({message:"Request timed out",timeout:r.timeout})}),r.timeout)}));i=n.race([i,a])}return i.then((function(e){return e.ok?Object(ne["a"])(r.success)===Object(ne["a"])(ie.noop)?e.json().then((function(e){r.success(e)})).catch((function(t){return n.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:n.reject({message:"API call failed",response:e})})).catch((function(e){Object(ne["a"])(r.error)===Object(ne["a"])(ie.noop)&&r.error(e.message||"<< internal error >>",e)})),i}}},ie.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||oe,webRTCAdapter:e&&e.adapter||re["a"],httpAPICall:function(e,n){var r=void 0!==n.body?{contentType:"application/json",data:JSON.stringify(n.body)}:{},o=void 0!==n.withCredentials?{xhrFields:{withCredentials:n.withCredentials}}:{};return t.ajax(t.extend(r,o,{url:e,type:n.verb,cache:!1,dataType:"json",async:n.async,timeout:n.timeout,success:function(e){Object(ne["a"])(n.success)===Object(ne["a"])(ie.noop)&&n.success(e)},error:function(e,t,r){Object(ne["a"])(n.error)===Object(ne["a"])(ie.noop)&&n.error(t,r)}}))}}},ie.noop=function(){},ie.dataChanDefaultLabel="JanusDataChannel",ie.endOfCandidates=null,ie.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:ie.noop,!0===ie.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),ie.trace=ie.noop,ie.debug=ie.noop,ie.vdebug=ie.noop,ie.log=ie.noop,ie.warn=ie.noop,ie.error=ie.noop,!0===e.debug||"all"===e.debug)ie.trace=console.trace.bind(console),ie.debug=console.debug.bind(console),ie.vdebug=console.debug.bind(console),ie.log=console.log.bind(console),ie.warn=console.warn.bind(console),ie.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t in e.debug){var n=e.debug[t];switch(n){case"trace":ie.trace=console.trace.bind(console);break;case"debug":ie.debug=console.debug.bind(console);break;case"vdebug":ie.vdebug=console.debug.bind(console);break;case"log":ie.log=console.log.bind(console);break;case"warn":ie.warn=console.warn.bind(console);break;case"error":ie.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}}ie.log("Initializing library");var r=e.dependencies||ie.useDefaultDependencies();ie.isArray=r.isArray,ie.webRTCAdapter=r.webRTCAdapter,ie.httpAPICall=r.httpAPICall,ie.newWebSocket=r.newWebSocket,ie.extension=r.extension,ie.extension.init(),ie.listDevices=function(e,t){e="function"==typeof e?e:ie.noop,null==t&&(t={audio:!0,video:!0}),ie.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(n){ie.debug(n),e(n);try{var r=t.getTracks();for(var o in r){var i=r[o];null!==i&&void 0!==i&&i.stop()}}catch(a){}}))})).catch((function(t){ie.error(t),e([])})):(ie.warn("navigator.mediaDevices unavailable"),e([]))},ie.attachMediaStream=function(e,t){if("chrome"===ie.webRTCAdapter.browserDetails.browser){var n=ie.webRTCAdapter.browserDetails.version;n>=52?e.srcObject=t:"undefined"!==typeof e.src?e.src=URL.createObjectURL(t):ie.error("Error attaching stream to element")}else e.srcObject=t},ie.reattachMediaStream=function(e,t){if("chrome"===ie.webRTCAdapter.browserDetails.browser){var n=ie.webRTCAdapter.browserDetails.version;n>=52?e.srcObject=t.srcObject:"undefined"!==typeof e.src?e.src=t.src:ie.error("Error reattaching stream to element")}else e.srcObject=t.srcObject};var o=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,i=o?"pagehide":"beforeunload",a=window["on"+i];if(window.addEventListener(i,(function(e){for(var t in ie.log("Closing window"),ie.sessions)null!==ie.sessions[t]&&void 0!==ie.sessions[t]&&ie.sessions[t].destroyOnUnload&&(ie.log("Destroying session "+t),ie.sessions[t].destroy({asyncRequest:!1,notifyDestroyed:!1}));a&&"function"==typeof a&&a()})),ie.safariVp8=!1,"safari"===ie.webRTCAdapter.browserDetails.browser&&ie.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var t in RTCRtpSender.getCapabilities("video").codecs){var s=RTCRtpSender.getCapabilities("video").codecs[t];if(s&&s.mimeType&&"video/vp8"===s.mimeType.toLowerCase()){ie.safariVp8=!0;break}}ie.safariVp8?ie.log("This version of Safari supports VP8"):ie.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var c=new RTCPeerConnection({},{});c.createOffer({offerToReceiveVideo:!0}).then((function(e){ie.safariVp8=-1!==e.sdp.indexOf("VP8"),ie.safariVp8?ie.log("This version of Safari supports VP8"):ie.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),c.close(),c=null}))}if(ie.unifiedPlan=!1,"firefox"===ie.webRTCAdapter.browserDetails.browser&&ie.webRTCAdapter.browserDetails.version>=59)ie.unifiedPlan=!0;else if("chrome"===ie.webRTCAdapter.browserDetails.browser&&ie.webRTCAdapter.browserDetails.version<72)ie.unifiedPlan=!1;else if("currentDirection"in RTCRtpTransceiver.prototype){var d=new RTCPeerConnection;try{d.addTransceiver("audio"),ie.unifiedPlan=!0}catch(l){}d.close()}else ie.unifiedPlan=!1;ie.initDone=!0,e.callback()}},ie.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection},ie.isGetUserMediaAvailable=function(){return void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&null!==navigator.mediaDevices.getUserMedia},ie.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<e;r++){var o=Math.floor(Math.random()*t.length);n+=t.substring(o,o+1)}return n};var ae=ie,se=function(){function e(t,n){Object(F["a"])(this,e),this.janusConnection=null,this.pluginHandle=null,this.connectURL=t,this.videoEL=n}return Object($["a"])(e,[{key:"doConnect",value:function(e){var t=this;ae.init({debug:!0,dependencies:ae.useDefaultDependencies(),callback:function(){t.onJanusInit(e)}})}},{key:"onJanusInit",value:function(e){var t=this,n=null;n="http:"===window.location.protocol?"http://"+this.connectURL+":8088/janus":"https://"+this.connectURL+":8089/janus",this.janusConnection=new ae({server:n,success:function(){t.onJanusConnect(t.janusConnection),e("showNotification",{message:"Janus connected successfully",type:""})},error:function(t){e("showNotification",{message:"JANUS SERVER ERROR",type:"danger"})},destroyed:function(){}})}},{key:"onJanusConnect",value:function(){var e=this,t="streamingtest-"+ae.randomString(12);this.janusConnection.attach({plugin:"janus.plugin.streaming",opaqueId:t,success:function(t){e.pluginHandle=t,e.onPluginAttached()},error:function(e){console.log("Error attaching plugin: "+e)},onremotestream:function(t){e.onRemoteStreamStart(t)},onmessage:function(t,n){e.onRemoteMessage(t,n)}})}},{key:"onRemoteStreamStart",value:function(e){ae.attachMediaStream(this.videoEL,e)}},{key:"onPluginAttached",value:function(){var e={request:"watch",id:10};this.pluginHandle.send({message:e})}},{key:"onRemoteMessage",value:function(e,t){var n=this,r=e["result"];r&&r["status"]&&"stopped"===r["status"]&&this.stopStream();var o=e["error"];o&&(console.log("Remote error: "+o),this.stopStream()),t&&this.pluginHandle.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){var t={request:"start"};n.pluginHandle.send({message:t,jsep:e})},error:function(e){console.log("Remote offer error: "+e)}})}},{key:"stopStream",value:function(){if(this.pluginHandle){var e={request:"stop"};this.pluginHandle.send({message:e}),this.pluginHandle.hangup()}}}]),e}(),ce=se,de={janusURL:window.localStorage.getItem("janusURL")||window.location.hostname,connected:!1},le={janusURL:function(e){return e.janusURL},janusConnected:function(e){return e.connected}},ue={teleopConnect:function(e,t){e.commit;var n=e.dispatch,r=e.state,o=new ce(r.janusURL,t);o.doConnect(n)},setJanusUrl:function(e,t){e.commit,e.dispatch;window.localStorage.setItem("janusURL",t),window.location.reload()},setConnectedState:function(e){var t=e.commit;t("connected",!0)}},ve={connected:function(e,t){return e.connected=t}},fe={state:de,getters:le,actions:ue,mutations:ve},pe=n("bc3a"),he=n.n(pe),ge={ssids:[],connecting:!1},me={ssidList:function(e){return e.ssids},wifiConnecting:function(e){return e.connecting},wifiScanning:function(e){return e.scanning}},be={getSSIDS:function(e){var t=e.commit,n=(e.state,e.dispatch);he.a.get("".concat(window.location.protocol,"//").concat(window.location.host,"/wifi-search")).then((function(e){t("ssids",e.data)})).catch((function(e){n("showNotification",{message:"Failed to retrieve networks.",type:"danger"})}))},rescanForSSIDS:function(e){var t=e.commit,n=(e.state,e.dispatch);n("showNotification",{message:"Scanning for networks... please wait.",type:""}),t("scanning",!0),he.a.post("".concat(window.location.protocol,"//").concat(window.location.host,"/wifi-rescan")).then((function(e){t("scanning",!1),t("ssids",e.data);var r={message:e.data.length+" connections found",type:""};n("showNotification",r)})).catch((function(e){console.log(e),n("showNotification",{message:e.response.data,type:"warning"})})),t("connecting",!1)},connectWifi:function(e,t){var n=e.commit,r=(e.state,e.dispatch);r("showNotification",{message:"Connecting to network... please wait.",type:""}),he.a.post("".concat(window.location.protocol,"//").concat(window.location.host,"/wifi-connect"),t).then((function(e){n("connecting",!1),n("ssids",e.data),r("showNotification",{message:"Connection successful",type:""})})).catch((function(e){r("showNotification",{message:"connection failed: re-connecting to previous network",type:"danger"})}))}},we={ssids:function(e,t){return e.ssids=t},connecting:function(e,t){return e.connecting=t},scanning:function(e,t){return e.scanning=t}},ye={state:ge,getters:me,actions:be,mutations:we};r["a"].use(c["a"]);var Se=new c["a"].Store({modules:{ros:G,teleop:fe,notifications:te,wifi:ye}}),ke=n("ecee"),_e=n("c074"),Te=n("ad3d");ke["c"].add(_e["b"],_e["c"],_e["a"]),r["a"].component("font-awesome-icon",Te["a"]),r["a"].config.productionTip=!1,new r["a"]({router:U,store:Se,render:function(e){return e(m)}}).$mount("#app")},"5c0b":function(e,t,n){"use strict";var r=n("e332"),o=n.n(r);o.a},"66b6":function(e,t,n){e.exports=n.p+"img/solid.fbce60ad.svg"},"8d31":function(e,t,n){"use strict";(function(e){var n=function(e){e=e||{},this._container=e.container||document.body,this._strokeStyle=e.strokeStyle||"cyan",this._stickEl=e.stickElement||this._buildJoystickStick(),this._baseEl=e.baseElement||this._buildJoystickBase(),this._mouseSupport=void 0!==e.mouseSupport&&e.mouseSupport,this._stationaryBase=e.stationaryBase||!1,this._baseX=this._stickX=e.baseX||0,this._baseY=this._stickY=e.baseY||0,this._limitStickTravel=e.limitStickTravel||!1,this._stickRadius=void 0!==e.stickRadius?e.stickRadius:100,this._useCssTransform=void 0!==e.useCssTransform&&e.useCssTransform,this._container.appendChild(this._baseEl),this._baseEl.style.position="absolute",this._baseEl.style.display="none",this._container.appendChild(this._stickEl),this._stickEl.style.position="absolute",this._stickEl.style.display="none",this._pressed=!1,this._touchIdx=null,!0===this._stationaryBase&&(this._baseEl.style.display="",this._baseEl.style.left=this._baseX-this._baseEl.width/2+"px",this._baseEl.style.top=this._baseY-this._baseEl.height/2+"px"),this._transform=!!this._useCssTransform&&this._getTransformProperty(),this._has3d=this._check3D();var t=function(e,t){return function(){return e.apply(t,arguments)}};this._$onTouchStart=t(this._onTouchStart,this),this._$onTouchEnd=t(this._onTouchEnd,this),this._$onTouchMove=t(this._onTouchMove,this),this._container.addEventListener("touchstart",this._$onTouchStart,!1),this._container.addEventListener("touchend",this._$onTouchEnd,!1),this._container.addEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._$onMouseDown=t(this._onMouseDown,this),this._$onMouseUp=t(this._onMouseUp,this),this._$onMouseMove=t(this._onMouseMove,this),this._container.addEventListener("mousedown",this._$onMouseDown,!1),this._container.addEventListener("mouseup",this._$onMouseUp,!1),this._container.addEventListener("mousemove",this._$onMouseMove,!1))};n.prototype.destroy=function(){this._container.removeChild(this._baseEl),this._container.removeChild(this._stickEl),this._container.removeEventListener("touchstart",this._$onTouchStart,!1),this._container.removeEventListener("touchend",this._$onTouchEnd,!1),this._container.removeEventListener("touchmove",this._$onTouchMove,!1),this._mouseSupport&&(this._container.removeEventListener("mouseup",this._$onMouseUp,!1),this._container.removeEventListener("mousedown",this._$onMouseDown,!1),this._container.removeEventListener("mousemove",this._$onMouseMove,!1))},n.touchScreenAvailable=function(){return"createTouch"in document},function(e){e.addEventListener=function(e,t){return void 0===this._events&&(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t),t},e.removeEventListener=function(e,t){void 0===this._events&&(this._events={}),e in this._events!==!1&&this._events[e].splice(this._events[e].indexOf(t),1)},e.dispatchEvent=function(e){if(void 0===this._events&&(this._events={}),void 0!==this._events[e])for(var t=this._events[e].slice(),n=0;n<t.length;n++){var r=t[n].apply(this,Array.prototype.slice.call(arguments,1));if(void 0!==r)return r}}}(n.prototype),n.prototype.deltaX=function(){return this._stickX-this._baseX},n.prototype.deltaY=function(){return this._stickY-this._baseY},n.prototype.up=function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t>=0)&&!(Math.abs(e)>2*Math.abs(t))},n.prototype.down=function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(t<=0)&&!(Math.abs(e)>2*Math.abs(t))},n.prototype.right=function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e<=0)&&!(Math.abs(t)>2*Math.abs(e))},n.prototype.left=function(){if(!1===this._pressed)return!1;var e=this.deltaX(),t=this.deltaY();return!(e>=0)&&!(Math.abs(t)>2*Math.abs(e))},n.prototype._onUp=function(){this._pressed=!1,this._stickEl.style.display="none",0==this._stationaryBase&&(this._baseEl.style.display="none",this._baseX=this._baseY=0,this._stickX=this._stickY=0)},n.prototype._onDown=function(e,t){if(this._pressed=!0,0==this._stationaryBase&&(this._baseX=e,this._baseY=t,this._baseEl.style.display="",this._move(this._baseEl.style,this._baseX-this._baseEl.width/2,this._baseY-this._baseEl.height/2)),this._stickX=e,this._stickY=t,!0===this._limitStickTravel){var n=this.deltaX(),r=this.deltaY(),o=Math.sqrt(n*n+r*r);if(o>this._stickRadius){var i=n/o,a=r/o;this._stickX=i*this._stickRadius+this._baseX,this._stickY=a*this._stickRadius+this._baseY}}this._stickEl.style.display="",this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2)},n.prototype._onMove=function(e,t){if(!0===this._pressed){if(this._stickX=e,this._stickY=t,!0===this._limitStickTravel){var n=this.deltaX(),r=this.deltaY(),o=Math.sqrt(n*n+r*r);if(o>this._stickRadius){var i=n/o,a=r/o;this._stickX=i*this._stickRadius+this._baseX,this._stickY=a*this._stickRadius+this._baseY}}this._move(this._stickEl.style,this._stickX-this._stickEl.width/2,this._stickY-this._stickEl.height/2)}},n.prototype._onMouseUp=function(e){return this._onUp()},n.prototype._onMouseDown=function(e){e.preventDefault();var t=e.clientX,n=e.clientY;return this._onDown(t,n)},n.prototype._onMouseMove=function(e){var t=e.clientX,n=e.clientY;return this._onMove(t,n)},n.prototype._onTouchStart=function(e){if(null===this._touchIdx){var t=this.dispatchEvent("touchStartValidation",e);if(!1!==t){this.dispatchEvent("touchStart",e),e.preventDefault();var n=e.changedTouches[0];this._touchIdx=n.identifier;var r=n.pageX,o=n.pageY;return this._onDown(r,o)}}},n.prototype._onTouchEnd=function(e){if(null!==this._touchIdx){this.dispatchEvent("touchEnd",e);for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length)return this._touchIdx=null,e.preventDefault(),this._onUp()}},n.prototype._onTouchMove=function(e){if(null!==this._touchIdx){for(var t=e.changedTouches,n=0;n<t.length&&t[n].identifier!==this._touchIdx;n++);if(n!==t.length){var r=t[n];e.preventDefault();var o=r.pageX,i=r.pageY;return this._onMove(o,i)}}},n.prototype._buildJoystickBase=function(){var e=document.createElement("canvas");e.width=126,e.height=126;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,2*Math.PI,!0),t.stroke(),t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=2,t.arc(e.width/2,e.width/2,60,0,2*Math.PI,!0),t.stroke(),e},n.prototype._buildJoystickStick=function(){var e=document.createElement("canvas");e.width=86,e.height=86;var t=e.getContext("2d");return t.beginPath(),t.strokeStyle=this._strokeStyle,t.lineWidth=6,t.arc(e.width/2,e.width/2,40,0,2*Math.PI,!0),t.stroke(),e},n.prototype._move=function(e,t,n){this._transform?this._has3d?e[this._transform]="translate3d("+t+"px,"+n+"px, 0)":e[this._transform]="translate("+t+"px,"+n+"px)":(e.left=t+"px",e.top=n+"px")},n.prototype._getTransformProperty=function(){for(var e,t=["webkitTransform","MozTransform","msTransform","OTransform","transform"],n=document.createElement("p"),r=0;r<t.length;r++)if(e=t[r],null!=n.style[e])return e},n.prototype._check3D=function(){var t=this._getTransformProperty();if(!t||!window.getComputedStyle)return e.exports=!1;var n={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},r=document.createElement("div");r.style[t]="translate3d(1px,1px,1px)",document.body.insertBefore(r,null);var o=getComputedStyle(r).getPropertyValue(n[t]);document.body.removeChild(r);var i=null!=o&&o.length&&"none"!=o;return i},t["a"]=n}).call(this,n("dd40")(e))},c911:function(e,t,n){e.exports=n.p+"img/rover-white.646d0bd9.svg"},e332:function(e,t,n){}});
//# sourceMappingURL=app.40d1dffd.js.map