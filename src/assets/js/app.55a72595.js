(function(e){function n(n){for(var r,a,s=n[0],d=n[1],c=n[2],l=0,v=[];l<s.length;l++)a=s[l],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&v.push(o[a][0]),o[a]=0;for(r in d)Object.prototype.hasOwnProperty.call(d,r)&&(e[r]=d[r]);u&&u(n);while(v.length)v.shift()();return i.push.apply(i,c||[]),t()}function t(){for(var e,n=0;n<i.length;n++){for(var t=i[n],r=!0,a=1;a<t.length;a++){var d=t[a];0!==o[d]&&(r=!1)}r&&(i.splice(n--,1),e=s(s.s=t[0]))}return e}var r={},o={app:0},i=[];function a(e){return s.p+"js/"+({about:"about"}[e]||e)+"."+{about:"dcdd9d11"}[e]+".js"}function s(n){if(r[n])return r[n].exports;var t=r[n]={i:n,l:!1,exports:{}};return e[n].call(t.exports,t,t.exports,s),t.l=!0,t.exports}s.e=function(e){var n=[],t=o[e];if(0!==t)if(t)n.push(t[2]);else{var r=new Promise((function(n,r){t=o[e]=[n,r]}));n.push(t[2]=r);var i,d=document.createElement("script");d.charset="utf-8",d.timeout=120,s.nc&&d.setAttribute("nonce",s.nc),d.src=a(e);var c=new Error;i=function(n){d.onerror=d.onload=null,clearTimeout(l);var t=o[e];if(0!==t){if(t){var r=n&&("load"===n.type?"missing":n.type),i=n&&n.target&&n.target.src;c.message="Loading chunk "+e+" failed.\n("+r+": "+i+")",c.name="ChunkLoadError",c.type=r,c.request=i,t[1](c)}o[e]=void 0}};var l=setTimeout((function(){i({type:"timeout",target:d})}),12e4);d.onerror=d.onload=i,document.head.appendChild(d)}return Promise.all(n)},s.m=e,s.c=r,s.d=function(e,n,t){s.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:t})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,n){if(1&n&&(e=s(e)),8&n)return e;if(4&n&&"object"===typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(s.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var r in e)s.d(t,r,function(n){return e[n]}.bind(null,r));return t},s.n=function(e){var n=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(n,"a",n),n},s.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},s.p="/",s.oe=function(e){throw console.error(e),e};var d=window["webpackJsonp"]=window["webpackJsonp"]||[],c=d.push.bind(d);d.push=n,d=d.slice();for(var l=0;l<d.length;l++)n(d[l]);var u=c;i.push([0,"chunk-vendors"]),t()})({0:function(e,n,t){e.exports=t("56d7")},"0418":function(e,n,t){"use strict";var r=function(){var e=this,n=e.$createElement,r=e._self._c||n;return r("header",{staticClass:"header"},[r("ul",{staticClass:"header-widgets"},[r("li",{staticClass:"header-widgets__widget header-widgets__widget--settings"},[r("router-link",{attrs:{to:"/settings"}},[r("svg",[r("use",{attrs:{"xlink:href":t("66b6")+"#cog"}})])])],1),r("li",{staticClass:"header-widgets__widget"},[r("label",{attrs:{for:"linear-velocity"}},[r("svg",[r("use",{attrs:{"xlink:href":t("66b6")+"#arrow-up"}})]),r("span",[e._v("Linear")])]),r("input",{staticClass:"range-widget",attrs:{id:"linear-velocity",type:"range",min:"1",max:"100",value:"25"},on:{input:e.updateLinearVelocity}}),r("span",[e._v(e._s(this.$store.getters.linearSpeed)+"%")])]),r("li",{staticClass:"header-widgets__widget"},[r("label",{attrs:{for:"angular-velocity"}},[r("svg",[r("use",{attrs:{"xlink:href":t("66b6")+"#redo-alt"}})]),r("span",[e._v("Angular")])]),r("input",{staticClass:"range-widget",attrs:{id:"angular-velocity",type:"range",min:"1",max:"100",value:"25"},on:{input:e.updateAngularVelocity}}),r("span",[e._v(e._s(this.$store.getters.angularSpeed)+"%")])]),r("li",{staticClass:"header-widgets__widget"},[r("div",{staticClass:"battery"},[r("div",{staticClass:"battery__inner",class:{battery__charging:this.$store.getters.batterySOC},style:{width:this.$store.getters.slowRateData.reg_robot_rel_soc_a+"%"}})]),r("span",{staticClass:"battery-percentage"},[e._v(" "+e._s(this.$store.getters.slowRateData.reg_robot_rel_soc_a)+"%")])])])])},o=[],i={name:"Header",methods:{updateLinearVelocity:function(e){this.$store.dispatch("updateLinearSpeed",e.target.value)},updateAngularVelocity:function(e){this.$store.dispatch("updateAngularSpeed",e.target.value)}}},a=i,s=t("2877"),d=Object(s["a"])(a,r,o,!1,null,null,null);n["a"]=d.exports},"56d7":function(e,n,t){"use strict";t.r(n);t("cadf"),t("551c"),t("f751"),t("097d");var r=t("2b0e"),o=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",{attrs:{id:"app"}},[t("router-view"),t("Snackbar")],1)},i=[],a=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",e._l(e.notificationMessages,(function(n,r){return t("div",{staticClass:"snackbar",style:{top:90-10*r+"%"}},[e._v("\n       "+e._s(n)+"\n    ")])})),0)},s=[],d=t("2f62"),c={name:"Snackbar",computed:Object(d["c"])(["notificationShow","notificationMessages"])},l=c,u=t("2877"),v=Object(u["a"])(l,a,s,!1,null,null,null),f=v.exports,g={components:{Snackbar:f},created:function(){this.$store.dispatch("initROS")}},p=g,m=(t("5c0b"),Object(u["a"])(p,o,i,!1,null,null,null)),h=m.exports,b=t("8c4f"),w=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("Header"),t("Dashboard")],1)},S=[],y=t("0418"),k=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("section",[t("video",{ref:"tele-video",staticClass:"stream",attrs:{width:"100%",height:"100%",id:"vid",autoplay:"",playsinline:"true","webkit-playsinline":"true",muted:"muted"},domProps:{muted:!0}}),t("MobileControls")],1)},C=[],T=function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("div",[t("div",{staticClass:"controls"},[t("button",{directives:[{name:"touch",rawName:"v-touch:start",value:e.touchDown,expression:"touchDown",arg:"start"},{name:"touch",rawName:"v-touch:end",value:e.touchUp,expression:"touchUp",arg:"end"}],staticClass:"controls__up",attrs:{"data-val":"87"}},[e._v("Up")]),t("button",{directives:[{name:"touch",rawName:"v-touch:start",value:e.touchDown,expression:"touchDown",arg:"start"},{name:"touch",rawName:"v-touch:end",value:e.touchUp,expression:"touchUp",arg:"end"}],staticClass:"controls__left",attrs:{"data-val":"65"}},[e._v("Left")]),t("button",{directives:[{name:"touch",rawName:"v-touch:start",value:e.touchDown,expression:"touchDown",arg:"start"},{name:"touch",rawName:"v-touch:end",value:e.touchUp,expression:"touchUp",arg:"end"}],staticClass:"controls__down",attrs:{"data-val":"83"}},[e._v("Down")]),t("button",{directives:[{name:"touch",rawName:"v-touch:start",value:e.touchDown,expression:"touchDown",arg:"start"},{name:"touch",rawName:"v-touch:end",value:e.touchUp,expression:"touchUp",arg:"end"}],staticClass:"controls__right",attrs:{"data-val":"68"}},[e._v("Right")])])])},R=[],D={name:"MobileControls",methods:{touchDown:function(e){this.$store.dispatch("mobileControl",e.target.dataset.val)},touchUp:function(){this.$store.dispatch("mobileControl","stop")}}},A=D,O=Object(u["a"])(A,T,R,!1,null,"20903510",null),I=O.exports,j={name:"Dashboard",components:{MobileControls:I},mounted:function(){this.$store.dispatch("teleopConnect",this.$refs["tele-video"])}},x=j,P=Object(u["a"])(x,k,C,!1,null,"326ebd34",null),V=P.exports,_={name:"home",components:{Header:y["a"],Dashboard:V}},M=_,L=Object(u["a"])(M,w,S,!1,null,null,null),E=L.exports;r["a"].use(b["a"]);var U=new b["a"]({mode:"history",base:"/",routes:[{path:"/",name:"home",component:E},{path:"/settings",name:"settings",component:function(){return t.e("about").then(t.bind(null,"26d3"))}}]}),N=(t("96cf"),t("3b8d")),J=t("e86b"),F=t("d225"),q=t("b0b4"),B=function(){function e(n,t,r){Object(F["a"])(this,e),this.ROS=n,this.topic=new J["Topic"]({ros:n,name:"/cmd_vel/keyboard",messageType:"geometry_msgs/Twist"}),this.throttle=6,this.currentMobileButton=null,this.linearScale=t/100,this.angularScale=r/100,this.x=0,this.y=0,this.z=0,window.innerWidth<800&&this.mobileControl(),this.controlListen()}return Object(q["a"])(e,[{key:"handleKey",value:function(e,n){console.log("handling key"),console.log(this.linearScale,this.angularScale);this.x,this.y,this.z;var t=!0,r=0,o=0;switch(!0===n&&(r=this.throttle*this.linearScale,o=this.throttle*this.angularScale),e){case 65:case 37:this.z=1*o;break;case 87:case 38:this.x=.25*r;break;case 68:case 39:this.z=-1*o;break;case 83:case 40:this.x=-.25*r;break;case 69:this.y=-.5*o;break;case 81:this.y=.5*o;break;default:t=!1}if(!0===t){var i=new J["Message"]({angular:{x:0,y:0,z:this.z},linear:{x:this.x,y:0,z:0}});this.topic.publish(i)}}},{key:"controlListen",value:function(){var e=this,n=document.getElementsByTagName("body")[0];n.addEventListener("keydown",(function(n){e.handleKey(n.keyCode,!0)}),!1),n.addEventListener("keyup",(function(n){e.handleKey(n.keyCode,!1)}),!1)}},{key:"stopRobot",value:function(){this.handleKey(this.currentMobileButton,!1),this.currentMobileButton=null}},{key:"mobileControl",value:function(){var e=this;setInterval((function(){e.currentMobileButton&&e.handleKey(e.currentMobileButton,!0)}),100)}},{key:"setLinearScale",set:function(e){this.linearScale=e/100}},{key:"setAngularScale",set:function(e){this.angularScale=e/100}}]),e}(),W=B,z={rosURL:JSON.parse(window.localStorage.getItem("rosURL"))||"ws://".concat(window.location.hostname,":9090"),batterySOC:null,batteryPercent:null,ROS:null,control:null,lastReceivedTime:null,linearSpeed:25,angularSpeed:25,slowRateData:{reg_robot_rel_soc_a:0}},G={rosURL:function(e){return e.rosURL},batterySOC:function(e){return e.batterySOC},linearSpeed:function(e){return e.linearSpeed},angularSpeed:function(e){return e.angularSpeed},slowRateData:function(e){return e.slowRateData}},H={setROSURL:function(){var e=Object(N["a"])(regeneratorRuntime.mark((function e(n,t){var r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=n.commit,n.dispatch,e.next=3,window.localStorage.setItem("rosURL",JSON.stringify(t));case 3:r("rosURL",t),window.location.reload();case 5:case"end":return e.stop()}}),e)})));function n(n,t){return e.apply(this,arguments)}return n}(),getROSURL:function(){var e=Object(N["a"])(regeneratorRuntime.mark((function e(n){var t,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=n.commit,e.next=3,JSON.parse(window.localStorage.getItem("rosURL"));case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0="ws://".concat(window.location.hostname,":9090");case 6:r=e.t0,console.log(r),t("rosURL",r);case 9:case"end":return e.stop()}}),e)})));function n(n){return e.apply(this,arguments)}return n}(),initROS:function(e){var n,t=e.commit,r=e.state,o=e.dispatch;console.log(r.rosURL),o("getROSURL");var i=new Promise((function(e,t){n=new J["Ros"]({url:r.rosURL}),setTimeout((function(){e()}),3e3)}));i.then((function(){n.isConnected?(t("ros",n),o("subscribe"),o("publish"),o("showNotification","ROS Connected"),o("receivedROSData")):(o("showNotification","WARNING: ROS Connection Error"),o("initROS"))}))},receivedROSData:function(e){var n=e.dispatch,t=(e.commit,e.state),r=setInterval((function(){console.log("checking connection");var e=Date.now();null!==t.lastReceivedTime&&e-t.lastReceivedTime>5e3&&(n("initROS"),clearInterval(r))}),5e3)},subscribe:function(e){var n=e.commit,t=(e.dispatch,e.state),r=new J["Topic"]({ros:t.ROS,name:"/rr_openrover_basic/charging",messageType:"std_msgs/Bool"}),o=new J["Topic"]({ros:t.ROS,name:"/rr_openrover_basic/raw_slow_rate_data",messageType:"rr_openrover_basic/RawRrOpenroverBasicSlowRateData"});o.subscribe((function(e){n("slowRateData",e),n("setLastReceivedTime",Date.now())})),r.subscribe((function(e){n("SOC",e.data),n("setLastReceivedTime",Date.now())}))},publish:function(e){var n=e.commit,t=e.state,r=new W(t.ROS,t.linearSpeed,t.angularSpeed);n("control",r)},updateLinearSpeed:function(e,n){var t=e.commit,r=e.state;t("linearSpeed",parseInt(n)),r.control.setLinearScale=r.linearSpeed},updateAngularSpeed:function(e,n){var t=e.commit;t("angularSpeed",parseInt(n)),z.control.setAngularScale=z.angularSpeed},mobileControl:function(e,n){e.commit;var t=e.state;parseInt(n)?t.control.currentMobileButton=parseInt(n):"stop"===n&&t.control.stopRobot()}},$={rosURL:function(e,n){return e.rosURL=n},SOC:function(e,n){return e.batterySOC=n},ros:function(e,n){return e.ROS=n},control:function(e,n){return e.control=n},linearSpeed:function(e,n){return e.linearSpeed=n},angularSpeed:function(e,n){return e.angularSpeed=n},slowRateData:function(e,n){return e.slowRateData=n},setLastReceivedTime:function(e,n){return e.lastReceivedTime=n}},K={state:z,getters:G,actions:H,mutations:$},Q={show:!1,messages:[]},Y={notificationShow:function(e){return e.show},notificationMessages:function(e){return e.messages}},X={showNotification:function(e,n){var t=e.commit;t("show",!0),t("messages",n),setTimeout((function(){t("show",!1),t("messages")}),2e3)}},Z={show:function(e,n){return e.show=n},messages:function(e,n){console.log(e.messages),n?e.messages.push(n):void 0===n&&e.messages.pop()}},ee={state:Q,getters:Y,actions:X,mutations:Z},ne=(t("aef6"),t("28a5"),t("7f7f"),t("7514"),t("7618")),te=(t("ac6a"),t("5df3"),t("4917"),t("d093"));oe.sessions={},oe.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),n=33;return window.navigator.userAgent.match("Linux")&&(n=35),e>=26&&e<=n||oe.extension.isInstalled()}return!0};var re={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var n=window.setTimeout((function(){var n=new Error("NavigatorUserMediaError");return n.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(n)}),1e3);this.cache[n]=e,window.postMessage({type:"janusGetScreen",id:n},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(n){if(n.origin==window.location.origin)if("janusGotScreen"==n.data.type&&e[n.data.id]){var t=e[n.data.id];if(delete e[n.data.id],""===n.data.sourceId){var r=new Error("NavigatorUserMediaError");r.name="You cancelled the request for permission, giving up...",t(r)}else t(null,n.data.sourceId)}else"janusGetScreenPending"==n.data.type&&(console.log("clearing ",n.data.id),window.clearTimeout(n.data.id))}))}};function oe(e){if(void 0===oe.initDone)return e.error("Library not initialized"),{};if(!oe.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(oe.log("Library initialized: "+oe.initDone),e=e||{},e.success="function"==typeof e.success?e.success:oe.noop,e.error="function"==typeof e.error?e.error:oe.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:oe.noop,null===e.server||void 0===e.server)return e.error("Invalid server url"),{};var n=!1,t=null,r={},o=null,i=null,a=0,s=e.server;oe.isArray(s)?(oe.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,oe.debug(i)):0===s.indexOf("ws")?(n=!0,oe.log("Using WebSockets to contact Janus: "+s)):(n=!1,oe.log("Using REST API to contact Janus: "+s));var d=e.iceServers;void 0!==d&&null!==d||(d=[{urls:"stun:stun.l.google.com:19302"}]);var c=e.iceTransportPolicy,l=e.bundlePolicy,u=e.ipv6;void 0!==u&&null!==u||(u=!1);var v=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(v=!0===e.withCredentials);var f=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(f=e.max_poll_events),f<1&&(f=1);var g=null;void 0!==e.token&&null!==e.token&&(g=e.token);var p=null;void 0!==e.apisecret&&null!==e.apisecret&&(p=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var m=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(m=e.keepAlivePeriod),isNaN(m)&&(m=25e3);var h=6e4;function b(e){var n={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(n.high=e.high),e.medium&&(n.medium=e.medium),e.low&&(n.low=e.low)),n}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(h=e.longPollTimeout),isNaN(h)&&(h=6e4);var w=!1,S=null,y={},k=this,C=0,T={};function R(){if(null!=S)if(oe.debug("Long poll..."),w){var n=s+"/"+S+"?rid="+(new Date).getTime();void 0!==f&&null!==f&&(n=n+"&maxev="+f),null!==g&&void 0!==g&&(n=n+"&token="+encodeURIComponent(g)),null!==p&&void 0!==p&&(n=n+"&apisecret="+encodeURIComponent(p)),oe.httpAPICall(n,{verb:"GET",withCredentials:v,success:D,timeout:h,error:function(n,t){if(oe.error(n+":",t),C++,C>3)return w=!1,void e.error("Lost connection to the server (is it down?)");R()}})}else oe.warn("Is the server down? (connected=false)")}function D(e,r){if(C=0,n||void 0===S||null===S||!0===r||R(),n||!oe.isArray(e))if("keepalive"!==e["janus"])if("ack"!==e["janus"])if("success"!==e["janus"])if("trickle"===e["janus"]){var o=e["sender"];if(void 0===o||null===o)return void oe.warn("Missing sender...");var i=y[o];if(void 0===i||null===i)return void oe.debug("This handle is not attached to this session");var a=e["candidate"];oe.debug("Got a trickled candidate on session "+S),oe.debug(a);var s=i.webrtcStuff;s.pc&&s.remoteSdp?(oe.debug("Adding remote candidate:",a),a&&!0!==a.completed?s.pc.addIceCandidate(a):s.pc.addIceCandidate(oe.endOfCandidates)):(oe.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),s.candidates||(s.candidates=[]),s.candidates.push(a),oe.debug(s.candidates))}else{if("webrtcup"===e["janus"]){oe.debug("Got a webrtcup event on session "+S),oe.debug(e);o=e["sender"];if(void 0===o||null===o)return void oe.warn("Missing sender...");i=y[o];return void 0===i||null===i?void oe.debug("This handle is not attached to this session"):void i.webrtcState(!0)}if("hangup"===e["janus"]){oe.debug("Got a hangup event on session "+S),oe.debug(e);o=e["sender"];if(void 0===o||null===o)return void oe.warn("Missing sender...");i=y[o];if(void 0===i||null===i)return void oe.debug("This handle is not attached to this session");i.webrtcState(!1,e["reason"]),i.hangup()}else if("detached"===e["janus"]){oe.debug("Got a detached event on session "+S),oe.debug(e);o=e["sender"];if(void 0===o||null===o)return void oe.warn("Missing sender...");i=y[o];if(void 0===i||null===i)return;i.detached=!0,i.ondetached(),i.detach()}else if("media"===e["janus"]){oe.debug("Got a media event on session "+S),oe.debug(e);o=e["sender"];if(void 0===o||null===o)return void oe.warn("Missing sender...");i=y[o];if(void 0===i||null===i)return void oe.debug("This handle is not attached to this session");i.mediaState(e["type"],e["receiving"])}else if("slowlink"===e["janus"]){oe.debug("Got a slowlink event on session "+S),oe.debug(e);o=e["sender"];if(void 0===o||null===o)return void oe.warn("Missing sender...");i=y[o];if(void 0===i||null===i)return void oe.debug("This handle is not attached to this session");i.slowLink(e["uplink"],e["lost"])}else{if("error"===e["janus"]){oe.error("Ooops: "+e["error"].code+" "+e["error"].reason),oe.debug(e);v=e["transaction"];if(null!==v&&void 0!==v){f=T[v];null!==f&&void 0!==f&&f(e),delete T[v]}return}if("event"===e["janus"]){oe.debug("Got a plugin event on session "+S),oe.debug(e);o=e["sender"];if(void 0===o||null===o)return void oe.warn("Missing sender...");var d=e["plugindata"];if(void 0===d||null===d)return void oe.warn("Missing plugindata...");oe.debug("  -- Event is coming from "+o+" ("+d["plugin"]+")");var c=d["data"];oe.debug(c);i=y[o];if(void 0===i||null===i)return void oe.warn("This handle is not attached to this session");var l=e["jsep"];void 0!==l&&null!==l&&(oe.debug("Handling SDP as well..."),oe.debug(l));var u=i.onmessage;null!==u&&void 0!==u?(oe.debug("Notifying application..."),u(c,l)):oe.debug("No provided notification callback")}else{if("timeout"===e["janus"])return oe.error("Timeout on session "+S),oe.debug(e),void(n&&t.close(3504,"Gateway timeout"));oe.warn("Unknown message/event  '"+e["janus"]+"' on session "+S),oe.debug(e)}}}else{oe.debug("Got a success on session "+S),oe.debug(e);var v=e["transaction"];if(null!==v&&void 0!==v){var f=T[v];null!==f&&void 0!==f&&f(e),delete T[v]}}else{oe.debug("Got an ack on session "+S),oe.debug(e);var v=e["transaction"];if(null!==v&&void 0!==v){var f=T[v];null!==f&&void 0!==f&&f(e),delete T[v]}}else oe.vdebug("Got a keepalive on session "+S);else for(var g=0;g<e.length;g++)D(e[g],!0)}function A(){if(null!==s&&n&&w){o=setTimeout(A,m);var e={janus:"keepalive",session_id:S,transaction:oe.randomString(12)};null!==g&&void 0!==g&&(e["token"]=g),null!==p&&void 0!==p&&(e["apisecret"]=p),t.send(JSON.stringify(e))}}function O(d){var c=oe.randomString(12),l={janus:"create",transaction:c};if(d["reconnect"]&&(w=!1,l["janus"]="claim",l["session_id"]=S,t&&(t.onopen=null,t.onerror=null,t.onclose=null,o&&(clearTimeout(o),o=null))),null!==g&&void 0!==g&&(l["token"]=g),null!==p&&void 0!==p&&(l["apisecret"]=p),null===s&&oe.isArray(i)&&(s=i[a],0===s.indexOf("ws")?(n=!0,oe.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+s+")")):(n=!1,oe.log("Server #"+(a+1)+": trying REST API to contact Janus ("+s+")"))),n)for(var u in t=oe.newWebSocket(s,"janus-protocol"),r={error:function(){if(oe.error("Error connecting to the Janus WebSockets server... "+s),oe.isArray(i)&&!d["reconnect"])return a++,a==i.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){O(d)}),200));d.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){T[c]=function(e){if(oe.debug(e),"success"!==e["janus"])return oe.error("Ooops: "+e["error"].code+" "+e["error"].reason),void d.error(e["error"].reason);o=setTimeout(A,m),w=!0,S=e["session_id"]?e["session_id"]:e.data["id"],d["reconnect"]?oe.log("Claimed session: "+S):oe.log("Created session: "+S),oe.sessions[S]=k,d.success()},t.send(JSON.stringify(l))},message:function(e){D(JSON.parse(e.data))},close:function(){null!==s&&w&&(w=!1,e.error("Lost connection to the server (is it down?)"))}},r)t.addEventListener(u,r[u]);else oe.httpAPICall(s,{verb:"POST",withCredentials:v,body:l,success:function(e){if(oe.debug(e),"success"!==e["janus"])return oe.error("Ooops: "+e["error"].code+" "+e["error"].reason),void d.error(e["error"].reason);w=!0,S=e["session_id"]?e["session_id"]:e.data["id"],d["reconnect"]?oe.log("Claimed session: "+S):oe.log("Created session: "+S),oe.sessions[S]=k,R(),d.success()},error:function(e,n){if(oe.error(e+":",n),oe.isArray(i)&&!d["reconnect"])return a++,a==i.length?void d.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){O(d)}),200));""===n?d.error(e+": Is the server down?"):d.error(e+": "+n)}})}function I(i){i=i||{},i.success="function"==typeof i.success?i.success:oe.noop;var a=!0;void 0!==i.asyncRequest&&null!==i.asyncRequest&&(a=!0===i.asyncRequest);var d=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(d=!0===i.notifyDestroyed);var c=!1;if(void 0!==i.cleanupHandles&&null!==i.cleanupHandles&&(c=!0===i.cleanupHandles),oe.log("Destroying session "+S+" (async="+a+")"),!w)return oe.warn("Is the server down? (connected=false)"),void i.success();if(void 0===S||null===S)return oe.warn("No session to destroy"),i.success(),void(d&&e.destroyed());if(c)for(var l in y)L(l,{noRequest:!0});var u={janus:"destroy",transaction:oe.randomString(12)};if(null!==g&&void 0!==g&&(u["token"]=g),null!==p&&void 0!==p&&(u["apisecret"]=p),n){u["session_id"]=S;var f=function(){for(var e in r)t.removeEventListener(e,r[e]);t.removeEventListener("message",m),t.removeEventListener("error",h),o&&clearTimeout(o),t.close()},m=function(n){var t=JSON.parse(n.data);t.session_id==u.session_id&&t.transaction==u.transaction&&(f(),i.success(),d&&e.destroyed())},h=function(n){f(),i.error("Failed to destroy the server: Is the server down?"),d&&e.destroyed()};return t.addEventListener("message",m),t.addEventListener("error",h),void t.send(JSON.stringify(u))}oe.httpAPICall(s+"/"+S,{verb:"POST",async:a,withCredentials:v,body:u,success:function(n){oe.log("Destroyed session:"),oe.debug(n),S=null,w=!1,"success"!==n["janus"]&&oe.error("Ooops: "+n["error"].code+" "+n["error"].reason),i.success(),d&&e.destroyed()},error:function(n,t){oe.error(n+":",t),S=null,w=!1,i.success(),d&&e.destroyed()}})}function j(e){if(e=e||{},e.success="function"==typeof e.success?e.success:oe.noop,e.error="function"==typeof e.error?e.error:oe.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:oe.noop,e.iceState="function"==typeof e.iceState?e.iceState:oe.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:oe.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:oe.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:oe.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:oe.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:oe.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:oe.noop,e.ondata="function"==typeof e.ondata?e.ondata:oe.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:oe.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:oe.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:oe.noop,!w)return oe.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var r=e.plugin;if(void 0===r||null===r)return oe.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.token?e.token:g,a=oe.randomString(12),d={janus:"attach",plugin:r,opaque_id:o,transaction:a};if(null!==i&&void 0!==i&&(d["token"]=i),null!==p&&void 0!==p&&(d["apisecret"]=p),n)return T[a]=function(n){if(oe.debug(n),"success"!==n["janus"])return oe.error("Ooops: "+n["error"].code+" "+n["error"].reason),void e.error("Ooops: "+n["error"].code+" "+n["error"].reason);var t=n.data["id"];oe.log("Created handle: "+t);var o={session:k,plugin:r,id:t,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return r},getVolume:function(){return B(t,!0)},getRemoteVolume:function(){return B(t,!0)},getLocalVolume:function(){return B(t,!1)},isAudioMuted:function(){return W(t,!1)},muteAudio:function(){return z(t,!1,!0)},unmuteAudio:function(){return z(t,!1,!1)},isVideoMuted:function(){return W(t,!0)},muteVideo:function(){return z(t,!0,!0)},unmuteVideo:function(){return z(t,!0,!1)},getBitrate:function(){return G(t)},send:function(e){x(t,e)},data:function(e){_(t,e)},dtmf:function(e){M(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(t,!0,e)},createAnswer:function(e){U(t,!1,e)},handleRemoteJsep:function(e){N(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){$(t,!0===e)},detach:function(e){L(t,e)}};y[t]=o,e.success(o)},d["session_id"]=S,void t.send(JSON.stringify(d));oe.httpAPICall(s+"/"+S,{verb:"POST",withCredentials:v,body:d,success:function(n){if(oe.debug(n),"success"!==n["janus"])return oe.error("Ooops: "+n["error"].code+" "+n["error"].reason),void e.error("Ooops: "+n["error"].code+" "+n["error"].reason);var t=n.data["id"];oe.log("Created handle: "+t);var o={session:k,plugin:r,id:t,token:i,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return t},getPlugin:function(){return r},getVolume:function(){return B(t,!0)},getRemoteVolume:function(){return B(t,!0)},getLocalVolume:function(){return B(t,!1)},isAudioMuted:function(){return W(t,!1)},muteAudio:function(){return z(t,!1,!0)},unmuteAudio:function(){return z(t,!1,!1)},isVideoMuted:function(){return W(t,!0)},muteVideo:function(){return z(t,!0,!0)},unmuteVideo:function(){return z(t,!0,!1)},getBitrate:function(){return G(t)},send:function(e){x(t,e)},data:function(e){_(t,e)},dtmf:function(e){M(t,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(t,!0,e)},createAnswer:function(e){U(t,!1,e)},handleRemoteJsep:function(e){N(t,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){$(t,!0===e)},detach:function(e){L(t,e)}};y[t]=o,e.success(o)},error:function(e,n){oe.error(e+":",n)}})}function x(e,r){if(r=r||{},r.success="function"==typeof r.success?r.success:oe.noop,r.error="function"==typeof r.error?r.error:oe.noop,!w)return oe.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var o=y[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return oe.warn("Invalid handle"),void r.error("Invalid handle");var i=r.message,a=r.jsep,d=oe.randomString(12),c={janus:"message",body:i,transaction:d};if(null!==o.token&&void 0!==o.token&&(c["token"]=o.token),null!==p&&void 0!==p&&(c["apisecret"]=p),null!==a&&void 0!==a&&(c.jsep=a),oe.debug("Sending message to plugin (handle="+e+"):"),oe.debug(c),n)return c["session_id"]=S,c["handle_id"]=e,T[d]=function(e){if(oe.debug("Message sent!"),oe.debug(e),"success"===e["janus"]){var n=e["plugindata"];if(void 0===n||null===n)return oe.warn("Request succeeded, but missing plugindata..."),void r.success();oe.log("Synchronous transaction successful ("+n["plugin"]+")");var t=n["data"];return oe.debug(t),void r.success(t)}"ack"===e["janus"]?r.success():void 0!==e["error"]&&null!==e["error"]?(oe.error("Ooops: "+e["error"].code+" "+e["error"].reason),r.error(e["error"].code+" "+e["error"].reason)):(oe.error("Unknown error"),r.error("Unknown error"))},void t.send(JSON.stringify(c));oe.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",withCredentials:v,body:c,success:function(e){if(oe.debug("Message sent!"),oe.debug(e),"success"===e["janus"]){var n=e["plugindata"];if(void 0===n||null===n)return oe.warn("Request succeeded, but missing plugindata..."),void r.success();oe.log("Synchronous transaction successful ("+n["plugin"]+")");var t=n["data"];return oe.debug(t),void r.success(t)}"ack"===e["janus"]?r.success():void 0!==e["error"]&&null!==e["error"]?(oe.error("Ooops: "+e["error"].code+" "+e["error"].reason),r.error(e["error"].code+" "+e["error"].reason)):(oe.error("Unknown error"),r.error("Unknown error"))},error:function(e,n){oe.error(e+":",n),r.error(e+": "+n)}})}function P(e,r){if(w){var o=y[e];if(null!==o&&void 0!==o&&null!==o.webrtcStuff&&void 0!==o.webrtcStuff){var i={janus:"trickle",candidate:r,transaction:oe.randomString(12)};if(null!==o.token&&void 0!==o.token&&(i["token"]=o.token),null!==p&&void 0!==p&&(i["apisecret"]=p),oe.vdebug("Sending trickle candidate (handle="+e+"):"),oe.vdebug(i),n)return i["session_id"]=S,i["handle_id"]=e,void t.send(JSON.stringify(i));oe.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",withCredentials:v,body:i,success:function(e){oe.vdebug("Candidate sent!"),oe.vdebug(e),"ack"===e["janus"]||oe.error("Ooops: "+e["error"].code+" "+e["error"].reason)},error:function(e,n){oe.error(e+":",n)}})}else oe.warn("Invalid handle")}else oe.warn("Is the server down? (connected=false)")}function V(e,n,t,r){var o=y[e];if(null!==o&&void 0!==o&&null!==o.webrtcStuff&&void 0!==o.webrtcStuff){var i=o.webrtcStuff,a=function(e){oe.log("Received message on data channel:",e);var n=e.target.label;o.ondata(e.data,n)},s=function(e){oe.log("Received state change on data channel:",e);var n=e.target.label,t=i.dataChannel[n]?i.dataChannel[n].readyState:"null";if(oe.log("State change on <"+n+"> data channel: "+t),"open"===t){if(i.dataChannel[n].pending&&i.dataChannel[n].pending.length>0){for(var r in oe.log("Sending pending messages on <"+n+">:",i.dataChannel[n].pending.length),i.dataChannel[n].pending){var a=i.dataChannel[n].pending[r];oe.log("Sending string on data channel <"+n+">: "+a),i.dataChannel[n].send(a)}i.dataChannel[n].pending=[]}o.ondataopen(n)}},d=function(e){oe.error("Got error on data channel:",e)};i.dataChannel[n]=t||i.pc.createDataChannel(n,{ordered:!1}),i.dataChannel[n].onmessage=a,i.dataChannel[n].onopen=s,i.dataChannel[n].onclose=s,i.dataChannel[n].onerror=d,i.dataChannel[n].pending=[],r&&i.dataChannel[n].pending.push(r)}else oe.warn("Invalid handle")}function _(e,n){n=n||{},n.success="function"==typeof n.success?n.success:oe.noop,n.error="function"==typeof n.error?n.error:oe.noop;var t=y[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return oe.warn("Invalid handle"),void n.error("Invalid handle");var r=t.webrtcStuff,o=n.text;if(null===o||void 0===o)return oe.warn("Invalid text"),void n.error("Invalid text");var i=n.label?n.label:oe.dataChanDefaultLabel;return r.dataChannel[i]?"open"!==r.dataChannel[i].readyState?(r.dataChannel[i].pending.push(o),void n.success()):(oe.log("Sending string on data channel <"+i+">: "+o),r.dataChannel[i].send(o),void n.success()):(V(e,i,!1,o),void n.success())}function M(e,n){n=n||{},n.success="function"==typeof n.success?n.success:oe.noop,n.error="function"==typeof n.error?n.error:oe.noop;var t=y[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return oe.warn("Invalid handle"),void n.error("Invalid handle");var r=t.webrtcStuff;if(null===r.dtmfSender||void 0===r.dtmfSender){if(void 0!==r.pc&&null!==r.pc){var o=r.pc.getSenders(),i=o.find((function(e){return e.track&&"audio"===e.track.kind}));if(!i)return oe.warn("Invalid DTMF configuration (no audio track)"),void n.error("Invalid DTMF configuration (no audio track)");r.dtmfSender=i.dtmf,r.dtmfSender&&(oe.log("Created DTMF Sender"),r.dtmfSender.ontonechange=function(e){oe.debug("Sent DTMF tone: "+e.tone)})}if(null===r.dtmfSender||void 0===r.dtmfSender)return oe.warn("Invalid DTMF configuration"),void n.error("Invalid DTMF configuration")}var a=n.dtmf;if(null===a||void 0===a)return oe.warn("Invalid DTMF parameters"),void n.error("Invalid DTMF parameters");var s=a.tones;if(null===s||void 0===s)return oe.warn("Invalid DTMF string"),void n.error("Invalid DTMF string");var d=a.duration;null!==d&&void 0!==d||(d=500);var c=a.gap;null!==c&&void 0!==c||(c=50),oe.debug("Sending DTMF string "+s+" (duration "+d+"ms, gap "+c+"ms)"),r.dtmfSender.insertDTMF(s,d,c),n.success()}function L(e,r){r=r||{},r.success="function"==typeof r.success?r.success:oe.noop,r.error="function"==typeof r.error?r.error:oe.noop;var o=!0;void 0!==r.asyncRequest&&null!==r.asyncRequest&&(o=!0===r.asyncRequest);var i=!0;void 0!==r.noRequest&&null!==r.noRequest&&(i=!0===r.noRequest),oe.log("Destroying handle "+e+" (async="+o+")"),$(e);var a=y[e];if(null===a||void 0===a||a.detached)return delete y[e],void r.success();if(i)return delete y[e],void r.success();if(!w)return oe.warn("Is the server down? (connected=false)"),void r.error("Is the server down? (connected=false)");var d={janus:"detach",transaction:oe.randomString(12)};if(null!==a.token&&void 0!==a.token&&(d["token"]=a.token),null!==p&&void 0!==p&&(d["apisecret"]=p),n)return d["session_id"]=S,d["handle_id"]=e,t.send(JSON.stringify(d)),delete y[e],void r.success();oe.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",async:o,withCredentials:v,body:d,success:function(n){oe.log("Destroyed handle:"),oe.debug(n),"success"!==n["janus"]&&oe.error("Ooops: "+n["error"].code+" "+n["error"].reason),delete y[e],r.success()},error:function(n,t){oe.error(n+":",t),delete y[e],r.success()}})}function E(e,n,t,r,o){var i=y[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return oe.warn("Invalid handle"),void r.error("Invalid handle");var a=i.webrtcStuff;oe.debug("streamsDone:",o),o&&(oe.debug("  -- Audio tracks:",o.getAudioTracks()),oe.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(a.myStream&&t.update&&!a.streamExternal){if((!t.update&&Q(t)||t.update&&(t.addAudio||t.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(a.myStream.addTrack(o.getAudioTracks()[0]),oe.unifiedPlan){oe.log((t.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var v=null,f=a.pc.getTransceivers();if(f&&f.length>0)for(var g in f){var p=f[g];if(p.sender&&p.sender.track&&"audio"===p.sender.track.kind||p.receiver&&p.receiver.track&&"audio"===p.receiver.track.kind){v=p;break}}v&&v.sender?v.sender.replaceTrack(o.getAudioTracks()[0]):a.pc.addTrack(o.getAudioTracks()[0],o)}else oe.log((t.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),a.pc.addTrack(o.getAudioTracks()[0],o);if((!t.update&&Z(t)||t.update&&(t.addVideo||t.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(a.myStream.addTrack(o.getVideoTracks()[0]),oe.unifiedPlan){oe.log((t.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var m=null;f=a.pc.getTransceivers();if(f&&f.length>0)for(var g in f){p=f[g];if(p.sender&&p.sender.track&&"video"===p.sender.track.kind||p.receiver&&p.receiver.track&&"video"===p.receiver.track.kind){m=p;break}}m&&m.sender?m.sender.replaceTrack(o.getVideoTracks()[0]):a.pc.addTrack(o.getVideoTracks()[0],o)}else oe.log((t.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),a.pc.addTrack(o.getVideoTracks()[0],o)}else a.myStream=o,s=!0;if(!a.pc){var h={iceServers:d,iceTransportPolicy:c,bundlePolicy:l};"chrome"===oe.webRTCAdapter.browserDetails.browser&&(h["sdpSemantics"]=oe.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var w={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===u&&w.optional.push({googIPv6:!0}),r.rtcConstraints&&"object"===Object(ne["a"])(r.rtcConstraints))for(var g in oe.debug("Adding custom PeerConnection constraints:",r.rtcConstraints),r.rtcConstraints)w.optional.push(r.rtcConstraints[g]);"edge"===oe.webRTCAdapter.browserDetails.browser&&(h.bundlePolicy="max-bundle"),oe.log("Creating PeerConnection"),oe.debug(w),a.pc=new RTCPeerConnection(h,w),oe.debug(a.pc),a.pc.getStats&&(a.volume={},a.bitrate.value="0 kbits/sec"),oe.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(e){a.pc&&i.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(n){if(null==n.candidate||"edge"===oe.webRTCAdapter.browserDetails.browser&&n.candidate.candidate.indexOf("endOfCandidates")>0)oe.log("End of candidates."),a.iceDone=!0,!0===a.trickle?P(e,{completed:!0}):q(e,r);else{var t={candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex};!0===a.trickle&&P(e,t)}},a.pc.ontrack=function(e){oe.log("Handling Remote Track"),oe.debug(e),e.streams&&(a.remoteStream=e.streams[0],i.onremotestream(a.remoteStream),e.track.onended||(oe.log("Adding onended callback to track:",e.track),e.track.onended=function(e){oe.log("Remote track muted/removed:",e),a.remoteStream&&(a.remoteStream.removeTrack(e.target),i.onremotestream(a.remoteStream))},e.track.onmute=e.track.onended,e.track.onunmute=function(e){oe.log("Remote track flowing again:",e);try{a.remoteStream.addTrack(e.target),i.onremotestream(a.remoteStream)}catch(n){oe.error(n)}}))}}if(s&&null!==o&&void 0!==o){oe.log("Adding local stream");var S=!0===r.simulcast2;o.getTracks().forEach((function(e){if(oe.log("Adding local track:",e),S)if("audio"===e.kind)a.pc.addTrack(e,o);else{oe.log("Enabling rid-based simulcasting:",e);var n=b(r.simulcastMaxBitrates);a.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{rid:"h",active:!0,maxBitrate:n.high},{rid:"m",active:!0,maxBitrate:n.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:n.low,scaleResolutionDownBy:4}]})}else a.pc.addTrack(e,o)}))}ie(t)&&!a.dataChannel[oe.dataChanDefaultLabel]&&(oe.log("Creating data channel"),V(e,oe.dataChanDefaultLabel,!1),a.pc.ondatachannel=function(n){oe.log("Data channel created by Janus:",n),V(e,n.channel.label,n.channel)}),a.myStream&&i.onlocalstream(a.myStream),null===n||void 0===n?J(e,t,r):a.pc.setRemoteDescription(n).then((function(){if(oe.log("Remote description accepted!"),a.remoteSdp=n.sdp,a.candidates&&a.candidates.length>0){for(var o=0;o<a.candidates.length;o++){var i=a.candidates[o];oe.debug("Adding remote candidate:",i),i&&!0!==i.completed?a.pc.addIceCandidate(i):a.pc.addIceCandidate(oe.endOfCandidates)}a.candidates=[]}F(e,t,r)}),r.error)}function U(e,n,t){t=t||{},t.success="function"==typeof t.success?t.success:oe.noop,t.error="function"==typeof t.error?t.error:H;var r=t.jsep;if(n&&r)return oe.error("Provided a JSEP to a createOffer"),void t.error("Provided a JSEP to a createOffer");if(!n&&(!r||!r.type||!r.sdp))return oe.error("A valid JSEP is required for createAnswer"),void t.error("A valid JSEP is required for createAnswer");t.media=t.media||{audio:!0,video:!0};var o=t.media,i=y[e];if(null===i||void 0===i||null===i.webrtcStuff||void 0===i.webrtcStuff)return oe.warn("Invalid handle"),void t.error("Invalid handle");var a=i.webrtcStuff;if(a.trickle=ae(t.trickle),void 0===a.pc||null===a.pc)o.update=!1,o.keepAudio=!1,o.keepVideo=!1;else if(void 0!==a.pc&&null!==a.pc){if(oe.log("Updating existing media session"),o.update=!0,null!==t.stream&&void 0!==t.stream)t.stream!==a.myStream&&oe.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return oe.error("Can't add audio stream, there already is one"),void t.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(null===a.myStream||void 0===a.myStream?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),Q(o)&&(o.keepAudio=!1,o.addAudio=!0)):null===a.myStream.getAudioTracks()||void 0===a.myStream.getAudioTracks()||0===a.myStream.getAudioTracks().length?(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),Q(o)&&(o.keepVideo=!1,o.addAudio=!0)):!Q(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return oe.error("Can't add video stream, there already is one"),void t.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);null===a.myStream||void 0===a.myStream?(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Z(o)&&(o.keepVideo=!1,o.addVideo=!0)):null===a.myStream.getVideoTracks()||void 0===a.myStream.getVideoTracks()||0===a.myStream.getVideoTracks().length?(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),Z(o)&&(o.keepVideo=!1,o.addVideo=!0)):!Z(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0),o.addData&&(o.data=!0)}if(Q(o)&&o.keepAudio&&Z(o)&&o.keepVideo)return i.consentDialog(!1),void E(e,r,o,t,a.myStream)}if(o.update&&!a.streamExternal){if(o.removeAudio||o.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var s=a.myStream.getAudioTracks()[0];oe.log("Removing audio track:",s),a.myStream.removeTrack(s);try{s.stop()}catch(O){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var d=!0;if(o.replaceAudio&&oe.unifiedPlan&&(d=!1),d)for(var c in a.pc.getSenders()){s=a.pc.getSenders()[c];s&&s.track&&"audio"===s.track.kind&&(oe.log("Removing audio sender:",s),a.pc.removeTrack(s))}}}if(o.removeVideo||o.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){s=a.myStream.getVideoTracks()[0];oe.log("Removing video track:",s),a.myStream.removeTrack(s);try{s.stop()}catch(O){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var l=!0;if(o.replaceVideo&&oe.unifiedPlan&&(l=!1),l)for(var c in a.pc.getSenders()){s=a.pc.getSenders()[c];s&&s.track&&"video"===s.track.kind&&(oe.log("Removing video sender:",s),a.pc.removeTrack(s))}}}}if(null!==t.stream&&void 0!==t.stream){var u=t.stream;if(oe.log("MediaStream provided by the application"),oe.debug(u),o.update&&a.myStream&&a.myStream!==t.stream&&!a.streamExternal){try{var v=a.myStream.getTracks();for(var f in v){var g=v[f];oe.log(g),null!==g&&void 0!==g&&g.stop()}}catch(O){}a.myStream=null}return a.streamExternal=!0,i.consentDialog(!1),void E(e,r,o,t,u)}if(Q(o)||Z(o)){if(!oe.isGetUserMediaAvailable())return void t.error("getUserMedia not available");var p={mandatory:{},optional:[]};i.consentDialog(!0);var m=Q(o);!0===m&&void 0!=o&&null!=o&&"object"===Object(ne["a"])(o.audio)&&(m=o.audio);var h=Z(o);if(!0===h&&void 0!=o&&null!=o){var b=!0===t.simulcast,w=!0===t.simulcast2;if(!b&&!w||r||void 0!==o.video&&!1!==o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===Object(ne["a"])(o.video))h=o.video;else{var S=0,k=0;"lowres"===o.video?(k=240,240,S=320):"lowres-16:9"===o.video?(k=180,180,S=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(k=720,720,S=1280):"fhdres"===o.video?(k=1080,1080,S=1920):"4kres"===o.video?(k=2160,2160,S=3840):"stdres"===o.video?(k=480,480,S=640):"stdres-16:9"===o.video?(k=360,360,S=640):(oe.log("Default video setting is stdres 4:3"),k=480,480,S=640),oe.log("Adding media constraint:",o.video),h={height:{ideal:k},width:{ideal:S}},oe.log("Adding video constraint:",h)}else if("screen"===o.video||"window"===o.video){var C=function(n,a){i.consentDialog(!1),n?t.error(n):E(e,r,o,t,a)},T=function(e,n,t){oe.log("Adding media constraint (screen capture)"),oe.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){t?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(t){e.addTrack(t.getAudioTracks()[0]),n(null,e)})):n(null,e)})).catch((function(e){i.consentDialog(!1),n(e)}))};if(o.screenshareFrameRate||(o.screenshareFrameRate=3),navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return void navigator.mediaDevices.getDisplayMedia({video:!0}).then((function(n){i.consentDialog(!1),Q(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){n.addTrack(i.getAudioTracks()[0]),E(e,r,o,t,n)})):E(e,r,o,t,n)}),(function(e){i.consentDialog(!1),t.error(e)}));if("chrome"===oe.webRTCAdapter.browserDetails.browser){var R=oe.webRTCAdapter.browserDetails.version,D=33;window.navigator.userAgent.match("Linux")&&(D=35),R>=26&&R<=D?(p={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:Q(o)&&!o.keepAudio},T(p,C)):oe.extension.getScreen((function(e,n){if(e)return i.consentDialog(!1),t.error(e);p={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},p.video.mandatory.chromeMediaSourceId=n,T(p,C,Q(o)&&!o.keepAudio)}))}else if("firefox"===oe.webRTCAdapter.browserDetails.browser){if(!(oe.webRTCAdapter.browserDetails.version>=33)){var A=new Error("NavigatorUserMediaError");return A.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void t.error(A)}p={video:{mozMediaSource:o.video,mediaSource:o.video},audio:Q(o)&&!o.keepAudio},T(p,(function(e,n){if(C(e,n),!e)var t=n.currentTime,r=window.setInterval((function(){n||window.clearInterval(r),n.currentTime==t&&(window.clearInterval(r),n.onended&&n.onended()),t=n.currentTime}),500)}))}return}}null!==o&&void 0!==o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(n){var a=n.some((function(e){return"audioinput"===e.kind})),s=re(o)||n.some((function(e){return"videoinput"===e.kind})),d=Q(o),c=Z(o),l=Y(o),v=ee(o);if(d||c||l||v){var f=!!d&&a,g=!!c&&s;if(!f&&!g)return i.consentDialog(!1),t.error("No capture device found"),!1;if(!f&&l)return i.consentDialog(!1),t.error("Audio capture is required, but no capture device found"),!1;if(!g&&v)return i.consentDialog(!1),t.error("Video capture is required, but no capture device found"),!1}var p={audio:!(!a||o.keepAudio)&&m,video:!(!s||o.keepVideo)&&h};oe.debug("getUserMedia constraints",p),p.audio||p.video?navigator.mediaDevices.getUserMedia(p).then((function(n){i.consentDialog(!1),E(e,r,o,t,n)})).catch((function(e){i.consentDialog(!1),t.error({code:e.code,name:e.name,message:e.message})})):(i.consentDialog(!1),E(e,r,o,t,u))})).catch((function(e){i.consentDialog(!1),t.error("enumerateDevices error",e)}))}else E(e,r,o,t)}function N(e,n){n=n||{},n.success="function"==typeof n.success?n.success:oe.noop,n.error="function"==typeof n.error?n.error:H;var t=n.jsep,r=y[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return oe.warn("Invalid handle"),void n.error("Invalid handle");var o=r.webrtcStuff;if(void 0!==t&&null!==t){if(null===o.pc)return oe.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void n.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");o.pc.setRemoteDescription(t).then((function(){if(oe.log("Remote description accepted!"),o.remoteSdp=t.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var r=o.candidates[e];oe.debug("Adding remote candidate:",r),r&&!0!==r.completed?o.pc.addIceCandidate(r):o.pc.addIceCandidate(oe.endOfCandidates)}o.candidates=[]}n.success()}),n.error)}else n.error("Invalid JSEP")}function J(e,n,t){t=t||{},t.success="function"==typeof t.success?t.success:oe.noop,t.error="function"==typeof t.error?t.error:oe.noop,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:oe.noop;var r=y[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return oe.warn("Invalid handle"),void t.error("Invalid handle");var o=r.webrtcStuff,i=!0===t.simulcast;i?oe.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):oe.log("Creating offer (iceDone="+o.iceDone+")");var a={};if(oe.unifiedPlan){var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0)for(var l in c){var u=c[l];u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?s||(s=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(d||(d=u))}var v=Q(n),f=X(n);v||f?v&&f?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",oe.log("Setting audio transceiver to sendrecv:",s)):v&&!f?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",oe.log("Setting audio transceiver to sendonly:",s)):!v&&f&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",oe.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),oe.log("Adding recvonly audio transceiver:",s))):n.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",oe.log("Setting audio transceiver to inactive:",s));var g=Z(n),p=te(n);g||p?g&&p?d&&(d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",oe.log("Setting video transceiver to sendrecv:",d)):g&&!p?d&&(d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",oe.log("Setting video transceiver to sendonly:",d)):!g&&p&&(d?(d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",oe.log("Setting video transceiver to recvonly:",d)):(d=o.pc.addTransceiver("video",{direction:"recvonly"}),oe.log("Adding recvonly video transceiver:",d))):n.removeVideo&&d&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive",oe.log("Setting video transceiver to inactive:",d))}else a["offerToReceiveAudio"]=X(n),a["offerToReceiveVideo"]=te(n);var m=!0===t.iceRestart;m&&(a["iceRestart"]=!0),oe.debug(a);var h=Z(n);if(h&&i&&"firefox"===oe.webRTCAdapter.browserDetails.browser){oe.log("Enabling Simulcasting for Firefox (RID)");var w=o.pc.getSenders().find((function(e){return"video"==e.track.kind}));if(w){var S=w.getParameters();S||(S={});var k=b(t.simulcastMaxBitrates);S.encodings=[{rid:"h",active:!0,maxBitrate:k.high},{rid:"m",active:!0,maxBitrate:k.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:k.low,scaleResolutionDownBy:4}],w.setParameters(S)}}o.pc.createOffer(a).then((function(e){oe.debug(e);var n={type:e.type,sdp:e.sdp};t.customizeSdp(n),e.sdp=n.sdp,oe.log("Setting local description"),h&&i&&("chrome"===oe.webRTCAdapter.browserDetails.browser||"safari"===oe.webRTCAdapter.browserDetails.browser?(oe.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=K(e.sdp)):"firefox"!==oe.webRTCAdapter.browserDetails.browser&&oe.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(t.error),o.mediaConstraints=a,o.iceDone||o.trickle?(oe.log("Offer ready"),oe.debug(t),t.success(e)):oe.log("Waiting for all candidates...")}),t.error)}function F(e,n,t){t=t||{},t.success="function"==typeof t.success?t.success:oe.noop,t.error="function"==typeof t.error?t.error:oe.noop,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:oe.noop;var r=y[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return oe.warn("Invalid handle"),void t.error("Invalid handle");var o=r.webrtcStuff,i=!0===t.simulcast;i?oe.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):oe.log("Creating answer (iceDone="+o.iceDone+")");var a=null;if(oe.unifiedPlan){a={};var s=null,d=null,c=o.pc.getTransceivers();if(c&&c.length>0)for(var l in c){var u=c[l];u.sender&&u.sender.track&&"audio"===u.sender.track.kind||u.receiver&&u.receiver.track&&"audio"===u.receiver.track.kind?s||(s=u):(u.sender&&u.sender.track&&"video"===u.sender.track.kind||u.receiver&&u.receiver.track&&"video"===u.receiver.track.kind)&&(d||(d=u))}var v=Q(n),f=X(n);if(v||f){if(v&&f){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",oe.log("Setting audio transceiver to sendrecv:",s)}catch(k){oe.error(k)}}else if(v&&!f)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",oe.log("Setting audio transceiver to sendonly:",s))}catch(k){oe.error(k)}else if(!v&&f)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",oe.log("Setting audio transceiver to recvonly:",s)}catch(k){oe.error(k)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),oe.log("Adding recvonly audio transceiver:",s)}else if(n.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",oe.log("Setting audio transceiver to inactive:",s)}catch(k){oe.error(k)}var g=Z(n),p=te(n);if(g||p){if(g&&p){if(d)try{d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",oe.log("Setting video transceiver to sendrecv:",d)}catch(k){oe.error(k)}}else if(g&&!p){if(d)try{d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",oe.log("Setting video transceiver to sendonly:",d)}catch(k){oe.error(k)}}else if(!g&&p)if(d)try{d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",oe.log("Setting video transceiver to recvonly:",d)}catch(k){oe.error(k)}else d=o.pc.addTransceiver("video",{direction:"recvonly"}),oe.log("Adding recvonly video transceiver:",d)}else if(n.removeVideo&&d)try{d.setDirection?d.setDirection("inactive"):d.direction="inactive",oe.log("Setting video transceiver to inactive:",d)}catch(k){oe.error(k)}}else a="firefox"==oe.webRTCAdapter.browserDetails.browser||"edge"==oe.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:X(n),offerToReceiveVideo:te(n)}:{mandatory:{OfferToReceiveAudio:X(n),OfferToReceiveVideo:te(n)}};oe.debug(a);var m=Z(n);if(m&&i&&"firefox"===oe.webRTCAdapter.browserDetails.browser){oe.log("Enabling Simulcasting for Firefox (RID)");var h=o.pc.getSenders()[1];oe.log(h);var w=h.getParameters();oe.log(w);var S=b(t.simulcastMaxBitrates);h.setParameters({encodings:[{rid:"high",active:!0,priority:"high",maxBitrate:S.high},{rid:"medium",active:!0,priority:"medium",maxBitrate:S.medium},{rid:"low",active:!0,priority:"low",maxBitrate:S.low}]})}o.pc.createAnswer(a).then((function(e){oe.debug(e);var n={type:e.type,sdp:e.sdp};t.customizeSdp(n),e.sdp=n.sdp,oe.log("Setting local description"),m&&i&&("chrome"===oe.webRTCAdapter.browserDetails.browser?oe.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==oe.webRTCAdapter.browserDetails.browser&&oe.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),o.mySdp=e.sdp,o.pc.setLocalDescription(e).catch(t.error),o.mediaConstraints=a,o.iceDone||o.trickle?t.success(e):oe.log("Waiting for all candidates...")}),t.error)}function q(e,n){n=n||{},n.success="function"==typeof n.success?n.success:oe.noop,n.error="function"==typeof n.error?n.error:oe.noop;var t=y[e];if(null!==t&&void 0!==t&&null!==t.webrtcStuff&&void 0!==t.webrtcStuff){var r=t.webrtcStuff;oe.log("Sending offer/answer SDP..."),null!==r.mySdp&&void 0!==r.mySdp?(r.mySdp={type:r.pc.localDescription.type,sdp:r.pc.localDescription.sdp},!1===r.trickle&&(r.mySdp["trickle"]=!1),oe.debug(n),r.sdpSent=!0,n.success(r.mySdp)):oe.warn("Local SDP instance is invalid, not sending anything...")}else oe.warn("Invalid handle, not sending anything")}function B(e,n){var t=y[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return oe.warn("Invalid handle"),0;var r=n?"remote":"local",o=t.webrtcStuff;return o.volume[r]||(o.volume[r]={value:0}),o.pc.getStats&&"chrome"===oe.webRTCAdapter.browserDetails.browser?!n||null!==o.remoteStream&&void 0!==o.remoteStream?n||null!==o.myStream&&void 0!==o.myStream?null===o.volume[r].timer||void 0===o.volume[r].timer?(oe.log("Starting "+r+" volume monitor"),o.volume[r].timer=setInterval((function(){o.pc.getStats((function(e){for(var t=e.result(),i=0;i<t.length;i++){var a=t[i];"ssrc"==a.type&&(n&&a.stat("audioOutputLevel")?o.volume[r].value=parseInt(a.stat("audioOutputLevel")):!n&&a.stat("audioInputLevel")&&(o.volume[r].value=parseInt(a.stat("audioInputLevel"))))}}))}),200),0):o.volume[r].value:(oe.warn("Local stream unavailable"),0):(oe.warn("Remote stream unavailable"),0):(oe.warn("Getting the "+r+" volume unsupported by browser"),0)}function W(e,n){var t=y[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return oe.warn("Invalid handle"),!0;var r=t.webrtcStuff;return null===r.pc||void 0===r.pc?(oe.warn("Invalid PeerConnection"),!0):void 0===r.myStream||null===r.myStream?(oe.warn("Invalid local MediaStream"),!0):n?null===r.myStream.getVideoTracks()||void 0===r.myStream.getVideoTracks()||0===r.myStream.getVideoTracks().length?(oe.warn("No video track"),!0):!r.myStream.getVideoTracks()[0].enabled:null===r.myStream.getAudioTracks()||void 0===r.myStream.getAudioTracks()||0===r.myStream.getAudioTracks().length?(oe.warn("No audio track"),!0):!r.myStream.getAudioTracks()[0].enabled}function z(e,n,t){var r=y[e];if(null===r||void 0===r||null===r.webrtcStuff||void 0===r.webrtcStuff)return oe.warn("Invalid handle"),!1;var o=r.webrtcStuff;return null===o.pc||void 0===o.pc?(oe.warn("Invalid PeerConnection"),!1):void 0===o.myStream||null===o.myStream?(oe.warn("Invalid local MediaStream"),!1):n?null===o.myStream.getVideoTracks()||void 0===o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length?(oe.warn("No video track"),!1):(o.myStream.getVideoTracks()[0].enabled=!t,!0):null===o.myStream.getAudioTracks()||void 0===o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length?(oe.warn("No audio track"),!1):(o.myStream.getAudioTracks()[0].enabled=!t,!0)}function G(e){var n=y[e];if(null===n||void 0===n||null===n.webrtcStuff||void 0===n.webrtcStuff)return oe.warn("Invalid handle"),"Invalid handle";var t=n.webrtcStuff;return null===t.pc||void 0===t.pc?"Invalid PeerConnection":t.pc.getStats?null===t.bitrate.timer||void 0===t.bitrate.timer?(oe.log("Starting bitrate timer (via getStats)"),t.bitrate.timer=setInterval((function(){t.pc.getStats().then((function(e){e.forEach((function(e){if(e){var n=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?n=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(n=!0),n)if(t.bitrate.bsnow=e.bytesReceived,t.bitrate.tsnow=e.timestamp,null===t.bitrate.bsbefore||null===t.bitrate.tsbefore)t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow;else{var r=t.bitrate.tsnow-t.bitrate.tsbefore;"safari"==oe.webRTCAdapter.browserDetails.browser&&(r/=1e3);var o=Math.round(8*(t.bitrate.bsnow-t.bitrate.bsbefore)/r);"safari"===oe.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),t.bitrate.value=o+" kbits/sec",t.bitrate.bsbefore=t.bitrate.bsnow,t.bitrate.tsbefore=t.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):t.bitrate.value:(oe.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser")}function H(e){oe.error("WebRTC error:",e)}function $(e,r){oe.log("Cleaning WebRTC stuff");var o=y[e];if(null!==o&&void 0!==o){var i=o.webrtcStuff;if(null!==i&&void 0!==i){if(!0===r){var a={janus:"hangup",transaction:oe.randomString(12)};null!==o.token&&void 0!==o.token&&(a["token"]=o.token),null!==p&&void 0!==p&&(a["apisecret"]=p),oe.debug("Sending hangup request (handle="+e+"):"),oe.debug(a),n?(a["session_id"]=S,a["handle_id"]=e,t.send(JSON.stringify(a))):oe.httpAPICall(s+"/"+S+"/"+e,{verb:"POST",withCredentials:v,body:a})}i.remoteStream=null,i.volume&&(i.volume["local"]&&i.volume["local"].timer&&clearInterval(i.volume["local"].timer),i.volume["remote"]&&i.volume["remote"].timer&&clearInterval(i.volume["remote"].timer)),i.volume={},i.bitrate.timer&&clearInterval(i.bitrate.timer),i.bitrate.timer=null,i.bitrate.bsnow=null,i.bitrate.bsbefore=null,i.bitrate.tsnow=null,i.bitrate.tsbefore=null,i.bitrate.value=null;try{if(!i.streamExternal&&null!==i.myStream&&void 0!==i.myStream){oe.log("Stopping local stream tracks");var d=i.myStream.getTracks();for(var c in d){var l=d[c];oe.log(l),null!==l&&void 0!==l&&l.stop()}}}catch(u){}i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(u){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null}o.oncleanup()}}function K(e){for(var n=e.split("\r\n"),t=!1,r=[-1],o=[-1],i=null,a=null,s=null,d=null,c=-1,l=0;l<n.length;l++){var u=n[l].match(/m=(\w+) */);if(u){var v=u[1];if("video"===v){if(!(r[0]<0)){c=l;break}t=!0}else if(r[0]>-1){c=l;break}}else if(t){var f=n[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(f)r[0]=f[1],o[0]=f[2],n.splice(l,1),l--;else{if(r[0]){var g=n[l].match("a=ssrc:"+r[0]+" cname:(.+)");if(g&&(i=g[1]),g=n[l].match("a=ssrc:"+r[0]+" msid:(.+)"),g&&(a=g[1]),g=n[l].match("a=ssrc:"+r[0]+" mslabel:(.+)"),g&&(s=g[1]),g=n[l].match("a=ssrc:"+r[0]+" label:(.+)"),g&&(d=g[1]),0===n[l].indexOf("a=ssrc:"+o[0])){n.splice(l,1),l--;continue}if(0===n[l].indexOf("a=ssrc:"+r[0])){n.splice(l,1),l--;continue}}0!=n[l].length||(n.splice(l,1),l--)}}}if(r[0]<0){c=-1,t=!1;for(l=0;l<n.length;l++){u=n[l].match(/m=(\w+) */);if(u){v=u[1];if("video"===v){if(!(r[0]<0)){c=l;break}t=!0}else if(r[0]>-1){c=l;break}}else if(t){if(r[0]<0){var p=n[l].match(/a=ssrc:(\d+)/);if(p){r[0]=p[1],n.splice(l,1),l--;continue}}else{g=n[l].match("a=ssrc:"+r[0]+" cname:(.+)");if(g&&(i=g[1]),g=n[l].match("a=ssrc:"+r[0]+" msid:(.+)"),g&&(a=g[1]),g=n[l].match("a=ssrc:"+r[0]+" mslabel:(.+)"),g&&(s=g[1]),g=n[l].match("a=ssrc:"+r[0]+" label:(.+)"),g&&(d=g[1]),0===n[l].indexOf("a=ssrc:"+o[0])){n.splice(l,1),l--;continue}if(0===n[l].indexOf("a=ssrc:"+r[0])){n.splice(l,1),l--;continue}}0!=n[l].length||(n.splice(l,1),l--)}}}if(r[0]<0)return oe.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=n.length),r[1]=Math.floor(4294967295*Math.random()),r[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(l=0;l<r.length;l++)i&&(n.splice(c,0,"a=ssrc:"+r[l]+" cname:"+i),c++),a&&(n.splice(c,0,"a=ssrc:"+r[l]+" msid:"+a),c++),s&&(n.splice(c,0,"a=ssrc:"+r[l]+" mslabel:"+s),c++),d&&(n.splice(c,0,"a=ssrc:"+r[l]+" label:"+d),c++),i&&(n.splice(c,0,"a=ssrc:"+o[l]+" cname:"+i),c++),a&&(n.splice(c,0,"a=ssrc:"+o[l]+" msid:"+a),c++),s&&(n.splice(c,0,"a=ssrc:"+o[l]+" mslabel:"+s),c++),d&&(n.splice(c,0,"a=ssrc:"+o[l]+" label:"+d),c++);return n.splice(c,0,"a=ssrc-group:FID "+r[2]+" "+o[2]),n.splice(c,0,"a=ssrc-group:FID "+r[1]+" "+o[1]),n.splice(c,0,"a=ssrc-group:FID "+r[0]+" "+o[0]),n.splice(c,0,"a=ssrc-group:SIM "+r[0]+" "+r[1]+" "+r[2]),e=n.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function Q(e){return oe.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function Y(e){return oe.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function X(e){return oe.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function Z(e){return oe.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function ee(e){return oe.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function te(e){return oe.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function re(e){if(oe.debug("isScreenSendEnabled:",e),void 0===e||null===e)return!1;if("object"!==Object(ne["a"])(e.video)||"object"!==Object(ne["a"])(e.video.mandatory))return!1;var n=e.video.mandatory;return n.chromeMediaSource?"desktop"===n.chromeMediaSource||"screen"===n.chromeMediaSource:n.mozMediaSource?"window"===n.mozMediaSource||"screen"===n.mozMediaSource:!!n.mediaSource&&("window"===n.mediaSource||"screen"===n.mediaSource)}function ie(e){return oe.debug("isDataEnabled:",e),"edge"==oe.webRTCAdapter.browserDetails.browser?(oe.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function ae(e){return oe.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}O(e),this.getServer=function(){return s},this.isConnected=function(){return w},this.reconnect=function(e){e=e||{},e.success="function"==typeof e.success?e.success:oe.noop,e.error="function"==typeof e.error?e.error:oe.noop,e["reconnect"]=!0,O(e)},this.getSessionId=function(){return S},this.destroy=function(e){I(e)},this.attach=function(e){j(e)}}oe.useDefaultDependencies=function(e){var n=e&&e.fetch||fetch,t=e&&e.Promise||Promise,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,n){return new r(e,n)},extension:e&&e.extension||re,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||te["a"],httpAPICall:function(e,r){var o={method:r.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===r.verb&&(o.headers["Content-Type"]="application/json"),void 0!==r.withCredentials&&(o.credentials=!0===r.withCredentials?"include":r.withCredentials?r.withCredentials:"omit"),void 0!==r.body&&(o.body=JSON.stringify(r.body));var i=n(e,o).catch((function(e){return t.reject({message:"Probably a network error, is the server down?",error:e})}));if(void 0!==r.timeout){var a=new t((function(e,n){var t=setTimeout((function(){return clearTimeout(t),n({message:"Request timed out",timeout:r.timeout})}),r.timeout)}));i=t.race([i,a])}return i.then((function(e){return e.ok?Object(ne["a"])(r.success)===Object(ne["a"])(oe.noop)?e.json().then((function(e){r.success(e)})).catch((function(n){return t.reject({message:"Failed to parse response body",error:n,response:e})})):void 0:t.reject({message:"API call failed",response:e})})).catch((function(e){Object(ne["a"])(r.error)===Object(ne["a"])(oe.noop)&&r.error(e.message||"<< internal error >>",e)})),i}}},oe.useOldDependencies=function(e){var n=e&&e.jQuery||jQuery,t=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,n){return new t(e,n)},isArray:function(e){return n.isArray(e)},extension:e&&e.extension||re,webRTCAdapter:e&&e.adapter||te["a"],httpAPICall:function(e,t){var r=void 0!==t.body?{contentType:"application/json",data:JSON.stringify(t.body)}:{},o=void 0!==t.withCredentials?{xhrFields:{withCredentials:t.withCredentials}}:{};return n.ajax(n.extend(r,o,{url:e,type:t.verb,cache:!1,dataType:"json",async:t.async,timeout:t.timeout,success:function(e){Object(ne["a"])(t.success)===Object(ne["a"])(oe.noop)&&t.success(e)},error:function(e,n,r){Object(ne["a"])(t.error)===Object(ne["a"])(oe.noop)&&t.error(n,r)}}))}}},oe.noop=function(){},oe.dataChanDefaultLabel="JanusDataChannel",oe.endOfCandidates=null,oe.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:oe.noop,!0===oe.initDone)e.callback();else{if("undefined"!=typeof console&&"undefined"!=typeof console.log||(console={log:function(){}}),oe.trace=oe.noop,oe.debug=oe.noop,oe.vdebug=oe.noop,oe.log=oe.noop,oe.warn=oe.noop,oe.error=oe.noop,!0===e.debug||"all"===e.debug)oe.trace=console.trace.bind(console),oe.debug=console.debug.bind(console),oe.vdebug=console.debug.bind(console),oe.log=console.log.bind(console),oe.warn=console.warn.bind(console),oe.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var n in e.debug){var t=e.debug[n];switch(t){case"trace":oe.trace=console.trace.bind(console);break;case"debug":oe.debug=console.debug.bind(console);break;case"vdebug":oe.vdebug=console.debug.bind(console);break;case"log":oe.log=console.log.bind(console);break;case"warn":oe.warn=console.warn.bind(console);break;case"error":oe.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}}oe.log("Initializing library");var r=e.dependencies||oe.useDefaultDependencies();oe.isArray=r.isArray,oe.webRTCAdapter=r.webRTCAdapter,oe.httpAPICall=r.httpAPICall,oe.newWebSocket=r.newWebSocket,oe.extension=r.extension,oe.extension.init(),oe.listDevices=function(e,n){e="function"==typeof e?e:oe.noop,null==n&&(n={audio:!0,video:!0}),oe.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(n).then((function(n){navigator.mediaDevices.enumerateDevices().then((function(t){oe.debug(t),e(t);try{var r=n.getTracks();for(var o in r){var i=r[o];null!==i&&void 0!==i&&i.stop()}}catch(a){}}))})).catch((function(n){oe.error(n),e([])})):(oe.warn("navigator.mediaDevices unavailable"),e([]))},oe.attachMediaStream=function(e,n){if("chrome"===oe.webRTCAdapter.browserDetails.browser){var t=oe.webRTCAdapter.browserDetails.version;t>=52?e.srcObject=n:"undefined"!==typeof e.src?e.src=URL.createObjectURL(n):oe.error("Error attaching stream to element")}else e.srcObject=n},oe.reattachMediaStream=function(e,n){if("chrome"===oe.webRTCAdapter.browserDetails.browser){var t=oe.webRTCAdapter.browserDetails.version;t>=52?e.srcObject=n.srcObject:"undefined"!==typeof e.src?e.src=n.src:oe.error("Error reattaching stream to element")}else e.srcObject=n.srcObject};var o=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,i=o?"pagehide":"beforeunload",a=window["on"+i];if(window.addEventListener(i,(function(e){for(var n in oe.log("Closing window"),oe.sessions)null!==oe.sessions[n]&&void 0!==oe.sessions[n]&&oe.sessions[n].destroyOnUnload&&(oe.log("Destroying session "+n),oe.sessions[n].destroy({asyncRequest:!1,notifyDestroyed:!1}));a&&"function"==typeof a&&a()})),oe.safariVp8=!1,"safari"===oe.webRTCAdapter.browserDetails.browser&&oe.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var n in RTCRtpSender.getCapabilities("video").codecs){var s=RTCRtpSender.getCapabilities("video").codecs[n];if(s&&s.mimeType&&"video/vp8"===s.mimeType.toLowerCase()){oe.safariVp8=!0;break}}oe.safariVp8?oe.log("This version of Safari supports VP8"):oe.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var d=new RTCPeerConnection({},{});d.createOffer({offerToReceiveVideo:!0}).then((function(e){oe.safariVp8=-1!==e.sdp.indexOf("VP8"),oe.safariVp8?oe.log("This version of Safari supports VP8"):oe.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),d.close(),d=null}))}if(oe.unifiedPlan=!1,"firefox"===oe.webRTCAdapter.browserDetails.browser&&oe.webRTCAdapter.browserDetails.version>=59)oe.unifiedPlan=!0;else if("chrome"===oe.webRTCAdapter.browserDetails.browser&&oe.webRTCAdapter.browserDetails.version<72)oe.unifiedPlan=!1;else if("currentDirection"in RTCRtpTransceiver.prototype){var c=new RTCPeerConnection;try{c.addTransceiver("audio"),oe.unifiedPlan=!0}catch(l){}c.close()}else oe.unifiedPlan=!1;oe.initDone=!0,e.callback()}},oe.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection},oe.isGetUserMediaAvailable=function(){return void 0!==navigator.mediaDevices&&null!==navigator.mediaDevices&&void 0!==navigator.mediaDevices.getUserMedia&&null!==navigator.mediaDevices.getUserMedia},oe.randomString=function(e){for(var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t="",r=0;r<e;r++){var o=Math.floor(Math.random()*n.length);t+=n.substring(o,o+1)}return t};var ie=oe,ae=function(){function e(n,t){Object(F["a"])(this,e),this.janusConnection=null,this.pluginHandle=null,this.connectURL=n,this.videoEL=t}return Object(q["a"])(e,[{key:"doConnect",value:function(e){var n=this;ie.init({debug:!0,dependencies:ie.useDefaultDependencies(),callback:function(){n.onJanusInit(e)}})}},{key:"onJanusInit",value:function(e){var n=this,t=null;t="http:"===window.location.protocol?"http://"+this.connectURL+":8088/janus":"https://"+this.connectURL+":8089/janus",this.janusConnection=new ie({server:t,success:function(){n.onJanusConnect(n.janusConnection),e("showNotification","Janus connected successfully")},error:function(n){e("showNotification","JANUS SERVER ERROR")},destroyed:function(){}})}},{key:"onJanusConnect",value:function(){var e=this,n="streamingtest-"+ie.randomString(12);this.janusConnection.attach({plugin:"janus.plugin.streaming",opaqueId:n,success:function(n){e.pluginHandle=n,e.onPluginAttached()},error:function(e){console.log("Error attaching plugin: "+e)},onremotestream:function(n){e.onRemoteStreamStart(n)},onmessage:function(n,t){e.onRemoteMessage(n,t)}})}},{key:"onRemoteStreamStart",value:function(e){ie.attachMediaStream(this.videoEL,e)}},{key:"onPluginAttached",value:function(){var e={request:"watch",id:10};this.pluginHandle.send({message:e})}},{key:"onRemoteMessage",value:function(e,n){var t=this,r=e["result"];r&&r["status"]&&"stopped"===r["status"]&&this.stopStream();var o=e["error"];o&&(console.log("Remote error: "+o),this.stopStream()),n&&this.pluginHandle.createAnswer({jsep:n,media:{audioSend:!1,videoSend:!1,data:!0},success:function(e){var n={request:"start"};t.pluginHandle.send({message:n,jsep:e})},error:function(e){console.log("Remote offer error: "+e)}})}},{key:"stopStream",value:function(){if(this.pluginHandle){var e={request:"stop"};this.pluginHandle.send({message:e}),this.pluginHandle.hangup()}}}]),e}(),se=ae,de={janusURL:window.localStorage.getItem("janusURL")||window.location.hostname},ce={janusURL:function(e){return e.janusURL}},le={teleopConnect:function(e,n){e.commit;var t=e.dispatch,r=e.state,o=new se(r.janusURL,n);o.doConnect(t)},setJanusUrl:function(e,n){e.commit,e.dispatch;window.localStorage.setItem("janusURL",n),window.location.reload()}},ue={},ve={state:de,getters:ce,actions:le,mutations:ue};r["a"].use(d["a"]);var fe=new d["a"].Store({modules:{ros:K,teleop:ve,notifications:ee}}),ge=t("0086"),pe=t.n(ge);r["a"].use(pe.a),r["a"].config.productionTip=!1,new r["a"]({router:U,store:fe,render:function(e){return e(h)}}).$mount("#app")},"5c0b":function(e,n,t){"use strict";var r=t("e332"),o=t.n(r);o.a},"66b6":function(e,n,t){e.exports=t.p+"img/solid.fbce60ad.svg"},e332:function(e,n,t){}});
//# sourceMappingURL=app.55a72595.js.map